# üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –≥–ª–∞–≤—ã 5

üìñ [–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏](../README.md) | üìÅ [–£—á–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã](../files/README.md) | ‚úÖ [–ß–µ–∫-–ª–∏—Å—Ç](../checklist.md)

---

## üîç –ó–∞–¥–∞–Ω–∏–µ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö

**üéØ –¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Ä–∞–∑–Ω—ã–º —Ç–∏–ø–∞–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Power Query –∏ –ø–æ–Ω–∏–º–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞.

**üìã –û–ø–∏—Å–∞–Ω–∏–µ:**  
–û—Å–≤–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–∏–ø–∞–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.

**üõ† –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

### üîó 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ —Ñ–∞–π–ª–æ–≤—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º:

**a) CSV —Ñ–∞–π–ª —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Excel ‚Üí **–î–∞–Ω–Ω—ã–µ** ‚Üí **–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** ‚Üí **–ò–∑ —Ñ–∞–π–ª–∞** ‚Üí **–ò–∑ —Ç–µ–∫—Å—Ç–∞/CSV**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª [`files/messy_sales_data.csv`](files/messy_sales_data.csv)
3. –í –æ–∫–Ω–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ:
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π
   - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
   - –ù–∞–ª–∏—á–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
4. –ù–∞–∂–º–∏—Ç–µ **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä Power Query

**b) Excel —Ñ–∞–π–ª —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–∏—Å—Ç–∞–º–∏:**
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: **–î–∞–Ω–Ω—ã–µ** ‚Üí **–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** ‚Üí **–ò–∑ —Ñ–∞–π–ª–∞** ‚Üí **–ò–∑ –∫–Ω–∏–≥–∏ Excel**
2. –í—ã–±–µ—Ä–∏—Ç–µ [`files/regional_data.xlsx`](files/regional_data.xlsx)
3. –ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞ ‚Äî —Å–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–∞–∂–¥–æ–º
4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫–æ –≤—Å–µ–º –ª–∏—Å—Ç–∞–º –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ –¥–∞–Ω–Ω—ã–º

**c) –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –≤–µ–±-–ª–æ–≥–∞–º–∏:**
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ [`files/web_data.txt`](files/web_data.txt) 
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º (–ø—Ä–æ–±–µ–ª –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å)
3. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏: IP, –î–∞—Ç–∞, –ú–µ—Ç–æ–¥, URL, –°—Ç–∞—Ç—É—Å, –†–∞–∑–º–µ—Ä, User_Agent

**d) –ü–∞–ø–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏:**
1. **–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** ‚Üí **–ò–∑ –ø–∞–ø–∫–∏** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ [`files/monthly_reports/`](files/monthly_reports/)
2. –û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É
3. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–æ–ª–±–µ—Ü —Å –∏–º–µ–Ω–µ–º –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### üìä 2. –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (CSV, Excel, TXT, –ü–∞–ø–∫–∞)  
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤
- –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### üîÑ 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **–°–≤–æ–π—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **"–û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞"**
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

**üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**  
Excel-—Ñ–∞–π–ª [`task1_data_connections.xlsx`] —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫–æ –≤—Å–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏ –∞–Ω–∞–ª–∏–∑–æ–º –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫.

---

## üßπ –ó–∞–¥–∞–Ω–∏–µ 2: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**üéØ –¶–µ–ª—å:** –û—Å–≤–æ–∏—Ç—å –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –æ—á–∏—Å—Ç–∫–∏ "–≥—Ä—è–∑–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∏—Ö –∫ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–º—É –≤–∏–¥—É.

**üìã –û–ø–∏—Å–∞–Ω–∏–µ:**  
–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –Ω–∞–±–æ—Ä—É —Å —Ç–∏–ø–∏—á–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

**üõ† –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

### üîç 1. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –≤ –¥–∞–Ω–Ω—ã—Ö:

–û—Ç–∫—Ä–æ–π—Ç–µ [`files/messy_sales_data.csv`](files/messy_sales_data.csv) –≤ Power Query –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

**–ü—Ä–æ–±–ª–µ–º—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
- [ ] –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- [ ] –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∏—Ç–æ–≥–∏ –≤–Ω—É—Ç—Ä–∏ –¥–∞–Ω–Ω—ã—Ö  
- [ ] –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏
- [ ] –î–∞–Ω–Ω—ã–µ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö

**–ü—Ä–æ–±–ª–µ–º—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**  
- [ ] –ß–∏—Å–ª–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–∞–∫ —Ç–µ–∫—Å—Ç (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏, –ª–∏—à–Ω–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏)
- [ ] –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç (–î–î.–ú–ú.–ì–ì–ì–ì, –ú–ú/–î–î/–ì–ì–ì–ì, —Ç–µ–∫—Å—Ç–æ–º)
- [ ] –õ–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- [ ] –°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–≥–∏—Å—Ç—Ä –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö (–ú–û–°–ö–í–ê, –º–æ—Å–∫–≤–∞, –ú–æ—Å–∫–≤–∞)

**–ü—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞:**
- [ ] –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö
- [ ] –ü–æ–ª–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø–∏—Å–µ–π
- [ ] –í—ã–±—Ä–æ—Å—ã –≤ —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—É–º–º—ã)
- [ ] –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)

### üõ† 2. –ü–æ—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:

**–®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
```m
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ Power Query (—è–∑—ã–∫ M)
let
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    –ò—Å—Ç–æ—á–Ω–∏–∫ = Csv.Document(File.Contents("messy_sales_data.csv")),
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    –ó–∞–≥–æ–ª–æ–≤–∫–∏ = Table.PromoteHeaders(–ò—Å—Ç–æ—á–Ω–∏–∫, [PromoteAllScalars=true]),
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
    –£–¥–∞–ª–µ–Ω–∏–µ–ü—É—Å—Ç—ã—Ö = Table.SelectRows(–ó–∞–≥–æ–ª–æ–≤–∫–∏, each not List.IsEmpty(List.RemoveMatchingItems(Record.FieldValues(_), {"", null})))
in
    –£–¥–∞–ª–µ–Ω–∏–µ–ü—É—Å—Ç—ã—Ö
```

**–®–∞–≥ 2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤**  
1. **–ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è:** —É–±–µ—Ä–∏—Ç–µ –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã, –ø—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ –≤ —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
2. **–î–∞—Ç—ã:** –ø—Ä–∏–≤–µ–¥–∏—Ç–µ –≤—Å–µ –∫ —Ñ–æ—Ä–º–∞—Ç—É –î–î.–ú–ú.–ì–ì–ì–ì
3. **–¢–µ–∫—Å—Ç:** —É–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã, –ø—Ä–∏–≤–µ–¥–∏—Ç–µ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
4. **–°—É–º–º—ã:** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å—É–º–º—ã –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤**
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –º–µ–¥–∏–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º  
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- **–î–∞—Ç—ã:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è:** —É–¥–∞–ª–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏

**–®–∞–≥ 4: –†–∞–±–æ—Ç–∞ —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏**
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–¥–∞—Ç–∞, –∫–ª–∏–µ–Ω—Ç, —Ç–æ–≤–∞—Ä)
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —É–¥–∞–ª–∏—Ç–µ –∏—Ö
3. –ù–∞–π–¥–∏—Ç–µ —á–∞—Å—Ç–∏—á–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Ä–µ—à–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏

### üìã 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π:

**–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:**
```
–ò—Å—Ö–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
"–û–û–û –†–æ–º–∞—à–∫–∞" ‚Üí "–û–û–û ¬´–†–æ–º–∞—à–∫–∞¬ª"  
"—Ä–æ–º–∞—à–∫–∞" ‚Üí "–û–û–û ¬´–†–æ–º–∞—à–∫–∞¬ª"
"Romashka Ltd" ‚Üí "–û–û–û ¬´–†–æ–º–∞—à–∫–∞¬ª"
```

**–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–æ—Ä–æ–¥–æ–≤:**
```
"–°–ü–±" ‚Üí "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"
"Moskva" ‚Üí "–ú–æ—Å–∫–≤–∞" 
"–ù.–ù–æ–≤–≥–æ—Ä–æ–¥" ‚Üí "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥"
```

### üìä 4. –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö:

–°–æ–∑–¥–∞–π—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ **"–¥–æ –∏ –ø–æ—Å–ª–µ"** –æ—á–∏—Å—Ç–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ—á–∏—Å—Ç–∫–∏ | –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------------|---------------|-----------|
| –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | | | |
| –ó–∞–ø–∏—Å–∏ —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ | | | |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ | | | |
| –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç | | | |
| –ß–∏—Å–ª–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ | | | |
| –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è | | | |

**üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**  
1. –û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: [`task2_cleaned_data.xlsx`]
2. –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ: [`task2_data_quality_report.xlsx`]
3. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π: [`task2_reference_tables.xlsx`]

---

## üíæ –ó–∞–¥–∞–Ω–∏–µ 3: –û—Å–≤–æ–µ–Ω–∏–µ –æ—Å–Ω–æ–≤ SQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**üéØ –¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

**üìã –û–ø–∏—Å–∞–Ω–∏–µ:**  
–†–∞–±–æ—Ç–∞–π—Ç–µ —Å —É—á–µ–±–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á.

**üõ† –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

### üóÑ 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª—ã CSV –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:
   - [`files/sql_customers.csv`](files/sql_customers.csv) ‚Üí —Ç–∞–±–ª–∏—Ü–∞ `customers`
   - [`files/sql_orders.csv`](files/sql_orders.csv) ‚Üí —Ç–∞–±–ª–∏—Ü–∞ `orders`  
   - [`files/sql_products.csv`](files/sql_products.csv) ‚Üí —Ç–∞–±–ª–∏—Ü–∞ `products`
   - [`files/sql_order_items.csv`](files/sql_order_items.csv) ‚Üí —Ç–∞–±–ª–∏—Ü–∞ `order_items`

**–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
CREATE TABLE customers (
    customer_id INTEGER PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    city VARCHAR(50) NOT NULL,
    registration_date DATE NOT NULL
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤  
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    price DECIMAL(10,2) NOT NULL
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE orders (
    order_id INTEGER PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date DATE NOT NULL,
    total_amount DECIMAL(12,2) NOT NULL
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE order_items (
    item_id INTEGER PRIMARY KEY,
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(product_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    price DECIMAL(10,2) NOT NULL
);
```

### üîç 2. –ë–∞–∑–æ–≤—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:

**a) –ü—Ä–æ—Å—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**
```sql
-- –ó–∞–¥–∞–Ω–∏–µ 2.1: –í—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤ 
SELECT order_id, customer_id, order_date, total_amount
FROM orders 
WHERE order_date >= '2023-07-01'
ORDER BY order_date DESC;

-- –ó–∞–¥–∞–Ω–∏–µ 2.2: –ö–ª–∏–µ–Ω—Ç—ã –∏–∑ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
SELECT customer_name, city, registration_date
FROM customers 
WHERE city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫')
ORDER BY city, customer_name;

-- –ó–∞–¥–∞–Ω–∏–µ 2.3: –¢–æ–ø-20 —Å–∞–º—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
SELECT product_name, category, price
FROM products 
ORDER BY price DESC 
LIMIT 20;
```

**b) –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**
```sql
-- –ó–∞–¥–∞–Ω–∏–µ 2.4: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã—Ä—É—á–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
SELECT 
    EXTRACT(YEAR FROM order_date) AS –≥–æ–¥,
    EXTRACT(MONTH FROM order_date) AS –º–µ—Å—è—Ü,
    COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∑–∞–∫–∞–∑–æ–≤,
    SUM(total_amount) AS –≤—ã—Ä—É—á–∫–∞,
    AVG(total_amount) AS —Å—Ä–µ–¥–Ω–∏–π_—á–µ–∫
FROM orders 
WHERE order_date >= '2023-01-01'
GROUP BY EXTRACT(YEAR FROM order_date), EXTRACT(MONTH FROM order_date)
ORDER BY –≥–æ–¥, –º–µ—Å—è—Ü;

-- –ó–∞–¥–∞–Ω–∏–µ 2.5: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º  
SELECT 
    city AS –≥–æ—Ä–æ–¥,
    COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∫–ª–∏–µ–Ω—Ç–æ–≤,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM customers), 2) AS –ø—Ä–æ—Ü–µ–Ω—Ç_–æ—Ç_–æ–±—â–µ–≥–æ
FROM customers 
GROUP BY city
ORDER BY –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∫–ª–∏–µ–Ω—Ç–æ–≤ DESC;

-- –ó–∞–¥–∞–Ω–∏–µ 2.6: –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤
SELECT 
    category AS –∫–∞—Ç–µ–≥–æ—Ä–∏—è,
    COUNT(*) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Ç–æ–≤–∞—Ä–æ–≤,
    AVG(price) AS —Å—Ä–µ–¥–Ω—è—è_—Ü–µ–Ω–∞,
    MIN(price) AS –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è_—Ü–µ–Ω–∞,
    MAX(price) AS –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è_—Ü–µ–Ω–∞
FROM products 
GROUP BY category
ORDER BY —Å—Ä–µ–¥–Ω—è—è_—Ü–µ–Ω–∞ DESC;
```

### üîó 3. –ó–∞–ø—Ä–æ—Å—ã —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü (JOIN):

```sql
-- –ó–∞–¥–∞–Ω–∏–µ 3.1: –ö–ª–∏–µ–Ω—Ç—ã —Å –∏—Ö –æ–±—â–µ–π —Å—É–º–º–æ–π –ø–æ–∫—É–ø–æ–∫
SELECT 
    c.customer_name AS –∫–ª–∏–µ–Ω—Ç,
    c.city AS –≥–æ—Ä–æ–¥,
    COUNT(o.order_id) AS –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∑–∞–∫–∞–∑–æ–≤,
    COALESCE(SUM(o.total_amount), 0) AS –æ–±—â–∞—è_—Å—É–º–º–∞,
    COALESCE(AVG(o.total_amount), 0) AS —Å—Ä–µ–¥–Ω–∏–π_—á–µ–∫
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name, c.city
ORDER BY –æ–±—â–∞—è_—Å—É–º–º–∞ DESC;

-- –ó–∞–¥–∞–Ω–∏–µ 3.2: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
SELECT 
    p.product_name AS —Ç–æ–≤–∞—Ä,
    p.category AS –∫–∞—Ç–µ–≥–æ—Ä–∏—è,
    SUM(oi.quantity) AS –ø—Ä–æ–¥–∞–Ω–æ_—à—Ç—É–∫,
    SUM(oi.quantity * oi.price) AS –≤—ã—Ä—É—á–∫–∞_–ø–æ_—Ç–æ–≤–∞—Ä—É,
    COUNT(DISTINCT oi.order_id) AS –∑–∞–∫–∞–∑–æ–≤_—Å_—Ç–æ–≤–∞—Ä–æ–º
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.product_name, p.category
ORDER BY –≤—ã—Ä—É—á–∫–∞_–ø–æ_—Ç–æ–≤–∞—Ä—É DESC;

-- –ó–∞–¥–∞–Ω–∏–µ 3.3: –¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏ —Ä–∞–∑—É –Ω–µ –ø–æ–∫—É–ø–∞–ª–∏
SELECT 
    product_name AS –Ω–µ–ø–æ–ø—É–ª—è—Ä–Ω—ã–π_—Ç–æ–≤–∞—Ä,
    category AS –∫–∞—Ç–µ–≥–æ—Ä–∏—è,
    price AS —Ü–µ–Ω–∞
FROM products 
WHERE product_id NOT IN (
    SELECT DISTINCT product_id 
    FROM order_items
)
ORDER BY price DESC;
```

### üìä 4. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:

```sql
-- –ó–∞–¥–∞–Ω–∏–µ 4.1: RFM –∞–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤
WITH customer_rfm AS (
    SELECT 
        c.customer_id,
        c.customer_name,
        c.city,
        MAX(o.order_date) AS –ø–æ—Å–ª–µ–¥–Ω–∏–π_–∑–∞–∫–∞–∑,
        COUNT(o.order_id) AS —á–∞—Å—Ç–æ—Ç–∞_–∑–∞–∫–∞–∑–æ–≤,
        SUM(o.total_amount) AS –¥–µ–Ω–µ–∂–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.customer_name, c.city
)
SELECT *,
    CURRENT_DATE - –ø–æ—Å–ª–µ–¥–Ω–∏–π_–∑–∞–∫–∞–∑ AS –¥–Ω–µ–π_—Å_–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ_–∑–∞–∫–∞–∑–∞,
    CASE 
        WHEN —á–∞—Å—Ç–æ—Ç–∞_–∑–∞–∫–∞–∑–æ–≤ >= 5 THEN '–í—ã—Å–æ–∫–∞—è'
        WHEN —á–∞—Å—Ç–æ—Ç–∞_–∑–∞–∫–∞–∑–æ–≤ >= 2 THEN '–°—Ä–µ–¥–Ω—è—è'
        ELSE '–ù–∏–∑–∫–∞—è'
    END AS —Å–µ–≥–º–µ–Ω—Ç_—á–∞—Å—Ç–æ—Ç—ã,
    CASE 
        WHEN –¥–µ–Ω–µ–∂–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å >= 50000 THEN 'VIP'
        WHEN –¥–µ–Ω–µ–∂–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å >= 15000 THEN '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π'
        WHEN –¥–µ–Ω–µ–∂–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å > 0 THEN '–û–±—ã—á–Ω—ã–π'
        ELSE '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'
    END AS —Å–µ–≥–º–µ–Ω—Ç_—Ü–µ–Ω–Ω–æ—Å—Ç–∏
FROM customer_rfm
ORDER BY –¥–µ–Ω–µ–∂–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å DESC;

-- –ó–∞–¥–∞–Ω–∏–µ 4.2: –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –º–µ—Å—è—Ü–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
SELECT 
    DATE_TRUNC('month', c.registration_date) AS –∫–æ–≥–æ—Ä—Ç–∞_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏,
    DATE_TRUNC('month', o.order_date) AS –º–µ—Å—è—Ü_–∑–∞–∫–∞–∑–∞,
    COUNT(DISTINCT c.customer_id) AS –∞–∫—Ç–∏–≤–Ω—ã—Ö_–∫–ª–∏–µ–Ω—Ç–æ–≤,
    SUM(o.total_amount) AS –≤—ã—Ä—É—á–∫–∞_–∫–æ–≥–æ—Ä—Ç—ã
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY DATE_TRUNC('month', c.registration_date), DATE_TRUNC('month', o.order_date)
ORDER BY –∫–æ–≥–æ—Ä—Ç–∞_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –º–µ—Å—è—Ü_–∑–∞–∫–∞–∑–∞;
```

### üìã 5. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views):

```sql
-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: –°–≤–æ–¥–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
CREATE VIEW customer_summary AS
SELECT 
    c.customer_id,
    c.customer_name,
    c.city,
    c.registration_date,
    COUNT(o.order_id) AS total_orders,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    MAX(o.order_date) AS last_order_date
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name, c.city, c.registration_date;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏  
CREATE VIEW monthly_sales AS
SELECT 
    EXTRACT(YEAR FROM order_date) AS year,
    EXTRACT(MONTH FROM order_date) AS month,
    COUNT(*) AS order_count,
    SUM(total_amount) AS revenue,
    AVG(total_amount) AS avg_order_value,
    COUNT(DISTINCT customer_id) AS unique_customers
FROM orders
GROUP BY EXTRACT(YEAR FROM order_date), EXTRACT(MONTH FROM order_date);
```

**üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**  
1. –§–∞–π–ª —Å SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏: [`task3_sql_queries.sql`]  
2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤ –≤ Excel: [`task3_sql_analysis.xlsx`]
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º: [`task3_views_documentation.md`]

---

## üîÑ –ó–∞–¥–∞–Ω–∏–µ 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

**üéØ –¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –æ—à–∏–±–æ–∫.

**üìã –û–ø–∏—Å–∞–Ω–∏–µ:**  
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞.

**üõ† –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

### ‚öôÔ∏è 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ ETL –ø—Ä–æ—Ü–µ—Å—Å–∞:

**VBA –º–∞–∫—Ä–æ—Å –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```vba
Sub AutoRefreshAllData()
'
' –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –¥–∞–Ω–Ω—ã–º
' –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞ –∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
'
    Dim conn As WorkbookConnection
    Dim startTime As Date
    Dim endTime As Date
    Dim duration As Double
    Dim errorCount As Integer
    
    ' –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
    startTime = Now()
    Call LogRefreshEvent("INFO", "–ù–∞—á–∞–ª–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö", startTime)
    
    ' –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    
    On Error GoTo ErrorHandler
    
    ' –¶–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    For Each conn In ThisWorkbook.Connections
        DoEvents ' –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        
        Select Case conn.Type
            Case xlConnectionTypeOLEDB, xlConnectionTypeODBC
                ' –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
                conn.Refresh
                Call LogRefreshEvent("SUCCESS", "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " & conn.Name, Now())
                
            Case xlConnectionTypeWEB  
                ' –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–±-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                conn.Refresh
                Call LogRefreshEvent("SUCCESS", "–û–±–Ω–æ–≤–ª–µ–Ω –≤–µ–±-–∏—Å—Ç–æ—á–Ω–∏–∫: " & conn.Name, Now())
                
            Case Else
                ' –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤  
                conn.Refresh
                Call LogRefreshEvent("SUCCESS", "–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª: " & conn.Name, Now())
        End Select
        
    Next conn
    
    ' –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
    Call DataQualityCheck
    
    ' –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
    endTime = Now()
    duration = DateDiff("s", startTime, endTime)
    
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    
    MsgBox "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" & vbCrLf & _
           "–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: " & duration & " —Å–µ–∫—É–Ω–¥" & vbCrLf & _
           "–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: " & ThisWorkbook.Connections.Count, _
           vbInformation, "–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"
    
    Call LogRefreshEvent("INFO", "–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—Ä–µ–º—è: " & duration & "—Å", endTime)
    
    Exit Sub
    
ErrorHandler:
    errorCount = errorCount + 1
    Call LogRefreshEvent("ERROR", "–û—à–∏–±–∫–∞: " & Err.Description & " –≤ " & conn.Name, Now())
    
    If errorCount < 3 Then
        Resume Next ' –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
    Else
        MsgBox "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫! –ü—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.", vbCritical
        Call SendEmailAlert("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö")
        End
    End If
End Sub
```

**–§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π:**
```vba
Sub LogRefreshEvent(logLevel As String, message As String, timestamp As Date)
    Dim wsLog As Worksheet
    Dim lastRow As Long
    
    ' –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –ª–æ–≥–æ–≤ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    On Error Resume Next
    Set wsLog = ThisWorkbook.Worksheets("RefreshLog")
    On Error GoTo 0
    
    If wsLog Is Nothing Then
        Set wsLog = ThisWorkbook.Worksheets.Add
        wsLog.Name = "RefreshLog"
        
        ' –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        wsLog.Cells(1, 1).Value = "Timestamp"
        wsLog.Cells(1, 2).Value = "Level"  
        wsLog.Cells(1, 3).Value = "Message"
        wsLog.Cells(1, 4).Value = "User"
    End If
    
    ' –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
    lastRow = wsLog.Cells(wsLog.Rows.Count, 1).End(xlUp).Row + 1
    wsLog.Cells(lastRow, 1).Value = timestamp
    wsLog.Cells(lastRow, 2).Value = logLevel
    wsLog.Cells(lastRow, 3).Value = message  
    wsLog.Cells(lastRow, 4).Value = Application.UserName
    
    ' –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—é –≤–∞–∂–Ω–æ—Å—Ç–∏
    Select Case logLevel
        Case "ERROR"
            wsLog.Rows(lastRow).Interior.Color = RGB(255, 200, 200)
        Case "WARNING"  
            wsLog.Rows(lastRow).Interior.Color = RGB(255, 255, 200)
        Case "SUCCESS"
            wsLog.Rows(lastRow).Interior.Color = RGB(200, 255, 200)
    End Select
End Sub
```

### üîç 2. –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:

**–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
```vba
Sub DataQualityCheck()
'
' –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
'
    Dim wsData As Worksheet
    Dim wsQuality As Worksheet
    Dim lastRow As Long
    Dim totalRecords As Long
    Dim missingValues As Long
    Dim duplicates As Long
    
    Set wsData = ThisWorkbook.Worksheets("CleanedData") 
    
    ' –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
    On Error Resume Next
    Set wsQuality = ThisWorkbook.Worksheets("DataQuality")
    On Error GoTo 0
    
    If wsQuality Is Nothing Then
        Set wsQuality = ThisWorkbook.Worksheets.Add
        wsQuality.Name = "DataQuality"
        Call CreateQualityDashboard(wsQuality)
    End If
    
    ' –ü–æ–¥—Å—á–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
    lastRow = wsData.Cells(wsData.Rows.Count, 1).End(xlUp).Row
    totalRecords = lastRow - 1 ' –ò—Å–∫–ª—é—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    
    ' –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
    wsQuality.Cells(2, 2).Value = totalRecords
    wsQuality.Cells(2, 3).Value = Now() ' –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    
    ' –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–ø—É—Å–∫–∏ (–≤ –ø–æ–ª–µ "–°—É–º–º–∞")
    missingValues = Application.CountBlank(wsData.Range("E2:E" & lastRow))
    wsQuality.Cells(3, 2).Value = missingValues
    wsQuality.Cells(3, 3).Value = Round(missingValues / totalRecords * 100, 2) & "%"
    
    ' –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –î—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –¥–∞—Ç–∞+–∫–ª–∏–µ–Ω—Ç)
    duplicates = CountDuplicates(wsData, "A2:B" & lastRow)
    wsQuality.Cells(4, 2).Value = duplicates
    
    ' –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–≤—ã–±—Ä–æ—Å—ã –≤ —Å—É–º–º–∞—Ö)
    Dim anomalies As Long
    anomalies = CountAnomalies(wsData, "E2:E" & lastRow)
    wsQuality.Cells(5, 2).Value = anomalies
    
    ' –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞)
    Dim maxDate As Date
    maxDate = Application.Max(wsData.Range("A2:A" & lastRow))
    wsQuality.Cells(6, 2).Value = maxDate
    wsQuality.Cells(6, 3).Value = Date - maxDate & " –¥–Ω. –Ω–∞–∑–∞–¥"
    
    ' –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
    Dim qualityScore As Integer
    qualityScore = CalculateQualityScore(totalRecords, missingValues, duplicates, anomalies)
    wsQuality.Cells(8, 2).Value = qualityScore & "%"
    
    ' –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
    If qualityScore >= 90 Then
        wsQuality.Cells(8, 2).Interior.Color = RGB(0, 255, 0) ' –ó–µ–ª–µ–Ω—ã–π
        wsQuality.Cells(8, 3).Value = "–û–¢–õ–ò–ß–ù–û"
    ElseIf qualityScore >= 75 Then
        wsQuality.Cells(8, 2).Interior.Color = RGB(255, 255, 0) ' –ñ–µ–ª—Ç—ã–π  
        wsQuality.Cells(8, 3).Value = "–•–û–†–û–®–û"
    Else
        wsQuality.Cells(8, 2).Interior.Color = RGB(255, 0, 0) ' –ö—Ä–∞—Å–Ω—ã–π
        wsQuality.Cells(8, 3).Value = "–¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø"
        
        ' –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∫–∞—á–µ—Å—Ç–≤–µ
        Call SendEmailAlert("–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö: " & qualityScore & "%")
    End If
    
    Call LogRefreshEvent("INFO", "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û—Ü–µ–Ω–∫–∞: " & qualityScore & "%", Now())
End Sub
```

### üìä 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

**–î–∞—à–±–æ—Ä–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –û–±–Ω–æ–≤–ª–µ–Ω–æ |
|---------|----------|---------|-----------|
| **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π** | =CountA(CleanedData!A:A)-1 | ‚úÖ | =NOW() |
| **–ü—Ä–æ–ø—É—Å–∫–∏ –≤ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö** | =COUNTBLANK(CleanedData!E:E) | ‚ö†Ô∏è | =NOW() |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏** | =COUNTIF(...) | ‚úÖ | =NOW() |  
| **–ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** | =COUNTIFS(...) | ‚ö†Ô∏è | =NOW() |
| **–ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö** | =MAX(CleanedData!A:A) | ‚úÖ | =NOW() |
| **–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | =RefreshLog!A2 | ‚úÖ | =NOW() |
| **–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞** | **85%** | **üü° –•–û–†–û–®–û** | =NOW() |

**–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- üü¢ **90-100%** ‚Äî –î–∞–Ω–Ω—ã–µ –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- üü° **75-89%** ‚Äî –î–∞–Ω–Ω—ã–µ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –µ—Å—Ç—å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- üî¥ **<75%** ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ

### üìß 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

**–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
```vba
Sub SendEmailAlert(alertMessage As String)
'
' –û—Ç–ø—Ä–∞–≤–∫–∞ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
'
    Dim OutlookApp As Object
    Dim OutlookMail As Object
    
    Set OutlookApp = CreateObject("Outlook.Application")
    Set OutlookMail = OutlookApp.CreateItem(0)
    
    With OutlookMail
        .To = "admin@company.com;analyst@company.com"
        .Subject = "–ê–õ–ï–†–¢: –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö - " & Format(Now(), "DD.MM.YYYY HH:MM")
        .Body = "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –¥–∞–Ω–Ω—ã—Ö:" & vbCrLf & vbCrLf & _
                "–°–æ–æ–±—â–µ–Ω–∏–µ: " & alertMessage & vbCrLf & _
                "–í—Ä–µ–º—è: " & Format(Now(), "DD.MM.YYYY HH:MM:SS") & vbCrLf & _
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " & Application.UserName & vbCrLf & _
                "–§–∞–π–ª: " & ThisWorkbook.FullName & vbCrLf & vbCrLf & _
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–∞–Ω–Ω—ã—Ö." & vbCrLf & vbCrLf & _
                "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö."
        .Send
    End With
    
    Set OutlookMail = Nothing
    Set OutlookApp = Nothing
    
    Call LogRefreshEvent("INFO", "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: " & alertMessage, Now())
End Sub
```

### ‚è∞ 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞:**
```vba
Private Sub Workbook_Open()
'
' –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞–π–ª–∞
'
    ' –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    Dim lastRefresh As Date
    Dim hoursElapsed As Double
    
    On Error Resume Next
    lastRefresh = ThisWorkbook.Worksheets("RefreshLog").Cells(2, 1).Value
    On Error GoTo 0
    
    hoursElapsed = (Now() - lastRefresh) * 24
    
    ' –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 2 —á–∞—Å–æ–≤, –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    If hoursElapsed > 2 Or lastRefresh = 0 Then
        MsgBox "–î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...", vbInformation
        Call AutoRefreshAllData
    Else
        MsgBox "–î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: " & Format(lastRefresh, "DD.MM.YYYY HH:MM"), vbInformation
    End If
End Sub
```

**üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**  
–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: [`task4_automated_data_system.xlsx`] –≤–∫–ª—é—á–∞—é—â–∞—è:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
2. –°–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫  
3. –î–∞—à–±–æ—Ä–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ü–≤–µ—Ç–æ–≤—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
4. Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã

---

## üèó –ó–∞–¥–∞–Ω–∏–µ 5: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –≤–∏—Ç—Ä–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö

**üéØ –¶–µ–ª—å:** –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≤–∏—Ç—Ä–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö (Data Mart) –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

**üìã –û–ø–∏—Å–∞–Ω–∏–µ:**  
–û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.

**üõ† –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

### üéØ 1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤–∏—Ç—Ä–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö:

**–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å:**
```
üìä –ò–°–¢–û–ß–ù–ò–ö–ò –î–ê–ù–ù–´–•
‚îú‚îÄ‚îÄ –§–∞–π–ª—ã –ø—Ä–æ–¥–∞–∂ (–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã)
‚îú‚îÄ‚îÄ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–∫–ª–∏–µ–Ω—Ç—ã, —Ç–æ–≤–∞—Ä—ã)  
‚îú‚îÄ‚îÄ –í–µ–±-–ª–æ–≥–∏ (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
‚îî‚îÄ‚îÄ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–∫–∞–∑—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

üîÑ ETL –ü–†–û–¶–ï–°–°–´
‚îú‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (Extract)
‚îú‚îÄ‚îÄ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è (Transform)  
‚îî‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ (Load)

üèó –°–õ–û–ò –î–ê–ù–ù–´–•  
‚îú‚îÄ‚îÄ Raw Layer (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚îú‚îÄ‚îÄ Clean Layer (–æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚îî‚îÄ‚îÄ Analytics Layer (–≤–∏—Ç—Ä–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö)

üìà –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ï –í–ò–¢–†–ò–ù–´
‚îú‚îÄ‚îÄ –í–∏—Ç—Ä–∏–Ω–∞ –ø—Ä–æ–¥–∞–∂
‚îú‚îÄ‚îÄ –í–∏—Ç—Ä–∏–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ –í–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤  
‚îî‚îÄ‚îÄ –í–∏—Ç—Ä–∏–Ω–∞ –≤–µ–±-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```

### üìä 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—è —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Raw Layer):

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Raw Layer:**
```
raw_data/
‚îú‚îÄ‚îÄ sales/
‚îÇ   ‚îú‚îÄ‚îÄ raw_monthly_sales_202301.csv
‚îÇ   ‚îú‚îÄ‚îÄ raw_monthly_sales_202302.csv  
‚îÇ   ‚îî‚îÄ‚îÄ raw_monthly_sales_202303.csv
‚îú‚îÄ‚îÄ customers/
‚îÇ   ‚îî‚îÄ‚îÄ raw_customers_master.csv
‚îú‚îÄ‚îÄ products/  
‚îÇ   ‚îî‚îÄ‚îÄ raw_products_catalog.csv
‚îî‚îÄ‚îÄ web_logs/
    ‚îî‚îÄ‚îÄ raw_web_activity.csv
```

**Power Query –¥–ª—è Raw Layer:**
```m
let
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    LoadRawData = (SourcePath as text, SourceType as text) =>
    let
        RawSource = Csv.Document(File.Contents(SourcePath)),
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        WithMetadata = Table.AddColumn(RawSource, "load_timestamp", each DateTime.LocalNow()),
        WithSource = Table.AddColumn(WithMetadata, "source_file", each SourcePath),
        WithType = Table.AddColumn(WithSource, "source_type", each SourceType),
        WithChecksum = Table.AddColumn(WithType, "data_checksum", each Text.From(Binary.ToText(Binary.FromText(Text.Combine(Record.FieldValues(_), "|")))))
    in
        WithChecksum,
        
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
    MonthlySales = Folder.Files("files/monthly_reports/"),
    ProcessedSales = Table.AddColumn(MonthlySales, "Data", each LoadRawData([Folder Path] & [Name], "monthly_sales")),
    
    // –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
    ExpandedSales = Table.ExpandTableColumn(ProcessedSales, "Data", {"Column1", "Column2", "Column3", "Column4", "Column5", "load_timestamp", "source_file", "source_type", "data_checksum"})
in
    ExpandedSales
```

### üßπ 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—è –æ—á–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Clean Layer):

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö:**

**–¢–∞–±–ª–∏—Ü–∞: clean_sales**
```sql
CREATE TABLE clean_sales (
    sale_id SERIAL PRIMARY KEY,
    sale_date DATE NOT NULL,
    customer_name VARCHAR(200) NOT NULL,
    product_name VARCHAR(200) NOT NULL,  
    quantity INTEGER CHECK (quantity > 0),
    unit_price DECIMAL(10,2) CHECK (unit_price > 0),
    total_amount DECIMAL(12,2),
    currency_code CHAR(3) DEFAULT 'RUB',
    source_file VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**–¢–∞–±–ª–∏—Ü–∞: clean_customers**
```sql
CREATE TABLE clean_customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(200) NOT NULL,
    customer_name_standard VARCHAR(200), -- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    city VARCHAR(100) NOT NULL,
    city_standard VARCHAR(100), -- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥
    registration_date DATE,
    customer_type VARCHAR(50), -- B2B, B2C
    inn VARCHAR(12), -- –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Power Query –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
```m
let
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂
    RawSales = Excel.CurrentWorkbook(){[Name="raw_monthly_sales"]}[Content],
    
    // –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    PromotedHeaders = Table.PromoteHeaders(RawSales, [PromoteAllScalars=true]),
    
    // –®–∞–≥ 2: –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
    FilteredRows = Table.SelectRows(PromotedHeaders, each not List.IsEmpty(List.RemoveMatchingItems(Record.FieldValues(_), {"", null}))),
    
    // –®–∞–≥ 3: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    ChangedType = Table.TransformColumnTypes(FilteredRows,{
        {"–î–∞—Ç–∞", type date}, 
        {"–¢–æ–≤–∞—Ä", type text}, 
        {"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", Int64.Type}, 
        {"–¶–µ–Ω–∞", type number}, 
        {"–°—É–º–º–∞", type number}
    }),
    
    // –®–∞–≥ 4: –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
    CleanedText = Table.TransformColumns(ChangedType,{
        {"–¢–æ–≤–∞—Ä", Text.Trim, type text}
    }),
    
    // –®–∞–≥ 5: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤
    StandardizedProducts = Table.ReplaceValue(CleanedText,"–¢–æ–≤–∞—Ä –ê","–¢–æ–≤–∞—Ä Alpha",Replacer.ReplaceText,{"–¢–æ–≤–∞—Ä"}),
    
    // –®–∞–≥ 6: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π
    WithCalculated = Table.AddColumn(StandardizedProducts, "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã", 
        each if [–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ] * [–¶–µ–Ω–∞] <> [–°—É–º–º–∞] then "–û–®–ò–ë–ö–ê" else "–û–ö"),
    
    // –®–∞–≥ 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
    ValidRecords = Table.SelectRows(WithCalculated, each [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã] = "–û–ö"),
    
    // –®–∞–≥ 8: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—á–∏—Å—Ç–∫–∏
    WithCleaningInfo = Table.AddColumn(ValidRecords, "cleaned_at", each DateTime.LocalNow())
in
    WithCleaningInfo
```

### üìä 4. –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∏—Ç—Ä–∏–Ω (Analytics Layer):

**–í–∏—Ç—Ä–∏–Ω–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º:**
```sql
CREATE VIEW sales_analytics AS
SELECT 
    DATE_TRUNC('month', sale_date) AS period_month,
    DATE_TRUNC('quarter', sale_date) AS period_quarter,
    DATE_TRUNC('year', sale_date) AS period_year,
    
    -- –û–±—ä–µ–º–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    COUNT(*) AS transactions_count,
    SUM(quantity) AS total_quantity,
    SUM(total_amount) AS total_revenue,
    
    -- –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏  
    AVG(total_amount) AS avg_transaction_amount,
    AVG(quantity) AS avg_quantity_per_transaction,
    
    -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
    COUNT(DISTINCT customer_name) AS unique_customers,
    COUNT(DISTINCT product_name) AS unique_products,
    
    -- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
    MIN(sale_date) AS period_start,
    MAX(sale_date) AS period_end,
    COUNT(*) FILTER (WHERE total_amount > 0) AS valid_transactions
    
FROM clean_sales 
GROUP BY 
    DATE_TRUNC('month', sale_date),
    DATE_TRUNC('quarter', sale_date), 
    DATE_TRUNC('year', sale_date);
```

**–í–∏—Ç—Ä–∏–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (RFM):**
```sql
CREATE VIEW customer_rfm_analysis AS
WITH customer_metrics AS (
    SELECT 
        customer_name,
        COUNT(*) AS frequency, -- Frequency: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫
        SUM(total_amount) AS monetary, -- Monetary: –æ–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫  
        MAX(sale_date) AS last_purchase_date,
        MIN(sale_date) AS first_purchase_date,
        
        -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        AVG(total_amount) AS avg_purchase_amount,
        STDDEV(total_amount) AS purchase_amount_variance,
        
        -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        EXTRACT(DAYS FROM (MAX(sale_date) - MIN(sale_date))) AS customer_lifetime_days
        
    FROM clean_sales
    GROUP BY customer_name
),
rfm_scores AS (
    SELECT *,
        -- Recency Score (–¥–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏)
        CURRENT_DATE - last_purchase_date AS recency_days,
        
        -- –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª–µ–π –¥–ª—è RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
        NTILE(5) OVER (ORDER BY CURRENT_DATE - last_purchase_date DESC) AS recency_score,
        NTILE(5) OVER (ORDER BY frequency) AS frequency_score,  
        NTILE(5) OVER (ORDER BY monetary) AS monetary_score
        
    FROM customer_metrics
)
SELECT *,
    -- –°–æ–∑–¥–∞–Ω–∏–µ RFM —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    CASE 
        WHEN recency_score >= 4 AND frequency_score >= 4 AND monetary_score >= 4 THEN 'VIP Champions'
        WHEN recency_score >= 3 AND frequency_score >= 3 AND monetary_score >= 3 THEN 'Loyal Customers'  
        WHEN recency_score >= 4 AND frequency_score <= 2 THEN 'New Customers'
        WHEN recency_score <= 2 AND frequency_score >= 3 THEN 'At Risk'
        WHEN recency_score <= 2 AND frequency_score <= 2 THEN 'Lost Customers'
        ELSE 'Regular Customers'
    END AS rfm_segment,
    
    -- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–µ–≥–º–µ–Ω—Ç–æ–º  
    CASE 
        WHEN recency_score >= 4 AND frequency_score >= 4 THEN 'Reward loyalty, upsell premium products'
        WHEN recency_score >= 4 AND frequency_score <= 2 THEN 'Welcome campaign, onboarding'
        WHEN recency_score <= 2 AND frequency_score >= 3 THEN 'Win-back campaign, special offers'
        WHEN recency_score <= 2 AND frequency_score <= 2 THEN 'Re-engagement campaign'
        ELSE 'Standard marketing approach'
    END AS marketing_recommendation

FROM rfm_scores;
```

### üìà 5. –°–æ–∑–¥–∞–Ω–∏–µ Power Pivot –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:

**–°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π –≤ Power Pivot:**
```
dim_time (–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)
‚îú‚îÄ‚îÄ date_key ‚Üí fact_sales.sale_date
‚îú‚îÄ‚îÄ year, quarter, month, day
‚îî‚îÄ‚îÄ is_weekend, is_holiday

dim_customers (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤)  
‚îú‚îÄ‚îÄ customer_key ‚Üí fact_sales.customer_key
‚îú‚îÄ‚îÄ customer_name, city, segment
‚îî‚îÄ‚îÄ registration_date, customer_type

dim_products (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤)
‚îú‚îÄ‚îÄ product_key ‚Üí fact_sales.product_key  
‚îú‚îÄ‚îÄ product_name, category
‚îî‚îÄ‚îÄ unit_price, is_active

fact_sales (—Ñ–∞–∫—Ç—ã –ø—Ä–æ–¥–∞–∂)
‚îú‚îÄ‚îÄ sale_date ‚Üí dim_time.date_key
‚îú‚îÄ‚îÄ customer_key ‚Üí dim_customers.customer_key
‚îú‚îÄ‚îÄ product_key ‚Üí dim_products.product_key
‚îî‚îÄ‚îÄ quantity, amount, unit_price
```

**DAX –º–µ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
```dax
// –ë–∞–∑–æ–≤—ã–µ –º–µ—Ä—ã –ø—Ä–æ–¥–∞–∂
Total Revenue = SUM(fact_sales[total_amount])

Total Transactions = COUNT(fact_sales[sale_id])

Average Transaction Value = 
DIVIDE([Total Revenue], [Total Transactions], 0)

// –ú–µ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º
Revenue Previous Month = 
CALCULATE(
    [Total Revenue],
    DATEADD(dim_time[date_key], -1, MONTH)
)

Revenue Growth % = 
DIVIDE(
    [Total Revenue] - [Revenue Previous Month], 
    [Revenue Previous Month], 
    0
) * 100

// –ú–µ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤  
Unique Customers = DISTINCTCOUNT(fact_sales[customer_key])

New Customers = 
CALCULATE(
    DISTINCTCOUNT(fact_sales[customer_key]),
    FILTER(
        dim_customers,
        dim_customers[registration_date] >= STARTOFMONTH(TODAY())
    )
)

Customer Retention Rate % = 
VAR CustomersLastMonth = 
    CALCULATE(
        DISTINCTCOUNT(fact_sales[customer_key]),
        DATEADD(dim_time[date_key], -1, MONTH)
    )
VAR ReturningCustomers = 
    CALCULATE(
        DISTINCTCOUNT(fact_sales[customer_key]),
        FILTER(
            fact_sales,
            fact_sales[customer_key] IN 
            CALCULATETABLE(
                VALUES(fact_sales[customer_key]),
                DATEADD(dim_time[date_key], -1, MONTH)
            )
        )
    )
RETURN
DIVIDE(ReturningCustomers, CustomersLastMonth, 0) * 100

// –ú–µ—Ä—ã –¥–ª—è —Ç–æ–≤–∞—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
Top Products by Revenue = 
RANKX(
    ALL(dim_products[product_name]),
    [Total Revenue],
    ,
    DESC
)

Product Performance Score = 
VAR ProductRevenue = [Total Revenue]
VAR AverageProductRevenue = 
    CALCULATE(
        AVERAGE(fact_sales[total_amount]),
        ALL(dim_products)
    )
RETURN
DIVIDE(ProductRevenue, AverageProductRevenue, 0)
```

### üìä 6. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞:

**–ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ KPI:**

| üìä **–ö–õ–Æ–ß–ï–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò** | **–¢–ï–ö–£–©–ò–ô –ú–ï–°–Ø–¶** | **–ò–ó–ú–ï–ù–ï–ù–ò–ï** |
|---|---|---|
| üí∞ –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ | =FORMAT([Total Revenue],"# ### ### ‚ÇΩ") | =IF([Revenue Growth %]>0,"‚Üó ","‚Üò ") & FORMAT([Revenue Growth %],"0.0%") |
| üõí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | =[Total Transactions] | =IF([Transaction Growth %]>0,"‚Üó ","‚Üò ") & [Transaction Growth %] |
| üí≥ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ | =FORMAT([Average Transaction Value],"# ### ‚ÇΩ") | =FORMAT([ATV Growth %],"0.0%") |
| üë• –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã | =[Unique Customers] | =FORMAT([Customer Growth %],"0.0%") |
| üîÑ Retention Rate | =FORMAT([Customer Retention Rate %],"0.0%") | =FORMAT([Retention Change],"0.0 –ø.–ø.") |

**–°—Ä–µ–∑—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã:**
- üìÖ **–ü–µ—Ä–∏–æ–¥**: –í—ã–±–æ—Ä –º–µ—Å—è—Ü–∞, –∫–≤–∞—Ä—Ç–∞–ª–∞, –≥–æ–¥–∞
- üèô **–ì–æ—Ä–æ–¥**: –§–∏–ª—å—Ç—Ä –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏  
- üì¶ **–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–æ–≤**: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- üë§ **–°–µ–≥–º–µ–Ω—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤**: RFM —Å–µ–≥–º–µ–Ω—Ç—ã, B2B/B2C
- üíº **–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: –ù–æ–≤—ã–µ/–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏

**–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (Drill-Down):**
```
–ì–æ–¥ ‚Üí –ö–≤–∞—Ä—Ç–∞–ª ‚Üí –ú–µ—Å—è—Ü ‚Üí –î–µ–Ω—å
–†–µ–≥–∏–æ–Ω ‚Üí –ì–æ—Ä–æ–¥ ‚Üí –†–∞–π–æ–Ω  
–ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üí –¢–æ–≤–∞—Ä ‚Üí SKU
–°–µ–≥–º–µ–Ω—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –ö–ª–∏–µ–Ω—Ç ‚Üí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```

### üìö 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∏—Ç—Ä–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö:

**–ö–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö (Data Catalog):**

| **–¢–∞–±–ª–∏—Ü–∞** | **–û–ø–∏—Å–∞–Ω–∏–µ** | **–ò—Å—Ç–æ—á–Ω–∏–∫** | **–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π** |
|-------------|-------------|-------------|----------------------|------------------|
| **dim_time** | –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏ | –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è | –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ | IT –æ—Ç–¥–µ–ª |
| **dim_customers** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ | CRM —Å–∏—Å—Ç–µ–º–∞ + —Ñ–∞–π–ª—ã | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ | –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ |
| **dim_products** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ | –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏ | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ | –¢–æ–≤–∞—Ä–Ω—ã–π –æ—Ç–¥–µ–ª |  
| **fact_sales** | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂ | –£—á–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ + —Ñ–∞–π–ª—ã | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç–¥–µ–ª |
| **web_activity** | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ | –í–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ | IT –æ—Ç–¥–µ–ª |

**–°–ª–æ–≤–∞—Ä—å –±–∏–∑–Ω–µ—Å-—Ç–µ—Ä–º–∏–Ω–æ–≤:**

| **–¢–µ—Ä–º–∏–Ω** | **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** | **–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞** |
|------------|-----------------|-------------------|
| **–í—ã—Ä—É—á–∫–∞** | –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–µ—Ä–∏–æ–¥ | SUM(quantity √ó unit_price) |
| **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫** | –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ √∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| **ARPU** | Average Revenue Per User | –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ √∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| **LTV** | Life Time Value –∫–ª–∏–µ–Ω—Ç–∞ | –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ √ó –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–∫—É–ø–æ–∫ √ó –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞ |
| **Retention Rate** | –î–æ–ª—è –≤–µ—Ä–Ω—É–≤—à–∏—Ö—Å—è –∫–ª–∏–µ–Ω—Ç–æ–≤ | –ö–ª–∏–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ ‚à© –ö–ª–∏–µ–Ω—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ √∑ –ö–ª–∏–µ–Ω—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ |

### üîÑ 8. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:

**–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:**
```sql
-- –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏—Ç—Ä–∏–Ω
CREATE OR REPLACE PROCEDURE daily_data_refresh()
LANGUAGE plpgsql AS $$
BEGIN
    -- 1. –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Raw Layer
    INSERT INTO raw_sales_staging 
    SELECT * FROM external_sales_feed 
    WHERE load_date = CURRENT_DATE;
    
    -- 2. –û—á–∏—Å—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    INSERT INTO clean_sales
    SELECT 
        sale_date,
        TRIM(UPPER(customer_name)) AS customer_name,
        TRIM(product_name) AS product_name,
        quantity,
        unit_price,
        quantity * unit_price AS total_amount
    FROM raw_sales_staging 
    WHERE quantity > 0 AND unit_price > 0;
    
    -- 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω
    REFRESH MATERIALIZED VIEW sales_analytics;
    REFRESH MATERIALIZED VIEW customer_rfm_analysis;
    
    -- 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
    ANALYZE clean_sales;
    ANALYZE dim_customers;
    
    -- 5. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (>2 –ª–µ—Ç)
    DELETE FROM raw_sales_staging 
    WHERE load_date < CURRENT_DATE - INTERVAL '730 days';
    
    -- 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    INSERT INTO etl_log (process_name, status, records_processed, execution_time)
    VALUES ('daily_refresh', 'SUCCESS', ROW_COUNT, NOW());
    
EXCEPTION
    WHEN OTHERS THEN
        INSERT INTO etl_log (process_name, status, error_message, execution_time)
        VALUES ('daily_refresh', 'ERROR', SQLERRM, NOW());
        RAISE;
END;
$$;
```

**üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**  
–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö: [`task5_enterprise_data_mart.xlsx`] –≤–∫–ª—é—á–∞—é—â–∞—è:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** ‚Äî —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ETL
2. **–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö** ‚Äî Raw/Clean/Analytics layers  
3. **Power Pivot –º–æ–¥–µ–ª—å** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏ –∏ DAX –º–µ—Ä–∞–º–∏
4. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥** —Å KPI, —Å—Ä–µ–∑–∞–º–∏ –∏ drill-down –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
5. **–ö–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–Ω—ã—Ö** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ –º–µ—Ç—Ä–∏–∫
6. **–ü—Ä–æ—Ü–µ–¥—É—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è** –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –≤–∏—Ç—Ä–∏–Ω—ã –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
7. **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –ø–æ —Ä–∞–±–æ—Ç–µ —Å –≤–∏—Ç—Ä–∏–Ω–æ–π –¥–∞–Ω–Ω—ã—Ö

---

## üí° –ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π

### üîß **–†–∞–±–æ—Ç–∞ —Å Power Query:**

**–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:**
- **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** ‚Äî –ø—Ä–æ–¥—É–º–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞—Ä–∞–Ω–µ–µ  
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —à–∞–≥–æ–≤** ‚Äî "–£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫", "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –¥–∞—Ç"
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ–±—Ä–∞–∑—Ü–∞—Ö** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏–∫—É –Ω–∞ 100-1000 –∑–∞–ø–∏—Å—è—Ö
- **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** ‚Äî –¥–ª—è –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º, –¥–∞—Ç, –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã** ‚Äî –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ M –∫–æ–¥–µ

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å –∫–æ–ø–∏—è–º–∏
- ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Äî –∏—Å—Å–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏—á–∏–Ω—ã
- ‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ —Ä–∞–∑ ‚Äî —Ä–∞–∑–±–∏–≤–∞–π—Ç–µ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —ç—Ç–∞–ø—ã
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

### üíæ **SQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤:**

**–ü–æ–¥—Ö–æ–¥ –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤:**
1. **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ** ‚Äî –±–∞–∑–æ–≤—ã–π SELECT –±–µ–∑ JOIN –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏  
2. **–ò–∑—É—á–∞–π—Ç–µ —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö** ‚Äî –ø–æ–Ω–∏–º–∞–π—Ç–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª–∏–∞—Å—ã** ‚Äî –∫—Ä–∞—Ç–∫–∏–µ, –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª–µ–π
4. **–§–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥** ‚Äî –æ—Ç—Å—Ç—É–ø—ã, –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ —á–∞—Å—Ç—è–º** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞–∂–¥—ã–π JOIN –∏ —Ñ–∏–ª—å—Ç—Ä –æ—Ç–¥–µ–ª—å–Ω–æ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```sql
-- ‚úÖ –•–æ—Ä–æ—à–æ: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ JOIN
SELECT c.customer_name, SUM(o.total_amount)
FROM customers c
JOIN (
    SELECT customer_id, total_amount 
    FROM orders 
    WHERE order_date >= '2023-01-01'  -- —Ñ–∏–ª—å—Ç—Ä –¥–æ JOIN
) o ON c.customer_id = o.customer_id
GROUP BY c.customer_name;

-- ‚ùå –ü–ª–æ—Ö–æ: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ JOIN  
SELECT c.customer_name, SUM(o.total_amount)
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
WHERE o.order_date >= '2023-01-01'  -- —Ñ–∏–ª—å—Ç—Ä –ø–æ—Å–ª–µ JOIN
GROUP BY c.customer_name;
```

### üßπ **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:**

**–ò–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫:**
1. **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å—Ö–µ–º—ã, —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** ‚Äî –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏, NOT NULL, CHECK constraints  
3. **–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—Ü–µ–Ω–∞ > 0, –¥–∞—Ç–∞ <= —Å–µ–≥–æ–¥–Ω—è)
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** ‚Äî –≤—ã–±—Ä–æ—Å—ã, –∞–Ω–æ–º–∞–ª–∏–∏, —Ç—Ä–µ–Ω–¥—ã

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫:**
```sql
-- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
CREATE OR REPLACE FUNCTION profile_table(table_name TEXT)
RETURNS TABLE(
    column_name TEXT,
    data_type TEXT,
    total_count BIGINT,
    null_count BIGINT,
    null_percentage NUMERIC,
    distinct_count BIGINT,
    min_value TEXT,
    max_value TEXT
) AS $$
BEGIN
    RETURN QUERY EXECUTE format('
        SELECT 
            column_name::TEXT,
            data_type::TEXT,
            COUNT(*)::BIGINT as total_count,
            COUNT(*) - COUNT(%I)::BIGINT as null_count,
            ROUND((COUNT(*) - COUNT(%I)) * 100.0 / COUNT(*), 2) as null_percentage,
            COUNT(DISTINCT %I)::BIGINT as distinct_count,
            MIN(%I::TEXT) as min_value,
            MAX(%I::TEXT) as max_value
        FROM %I
        GROUP BY column_name, data_type
    ', column_name, column_name, column_name, column_name, column_name, table_name);
END;
$$ LANGUAGE plpgsql;
```

### üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞–¥–µ–∂–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∞—Ä—É—à–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –ª–∏–±–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å, –ª–∏–±–æ –Ω–∏ –æ–¥–Ω–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å—é
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–æ—Å—Ç—å** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```vba
Sub SafeDataProcessing()
    Dim errorCount As Integer
    Dim maxErrors As Integer: maxErrors = 3
    
    On Error GoTo ErrorHandler
    
    ' –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    Call ProcessDataSource1
    Call ProcessDataSource2  
    Call ProcessDataSource3
    
    Exit Sub
    
ErrorHandler:
    errorCount = errorCount + 1
    
    ' –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
    Call LogError(Err.Number, Err.Description, "ProcessDataSource")
    
    ' –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    If errorCount <= maxErrors Then
        Wait Application.Wait(Now + TimeValue("00:00:05")) ' –ü–∞—É–∑–∞ 5 —Å–µ–∫—É–Ω–¥
        Resume Next
    Else
        MsgBox "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫!", vbCritical
        Call SendAlertToAdmin("Critical error in data processing")
        End
    End If
End Sub
```

### ‚ùì **–†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:**

#### **–ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Power Query**
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö
- –£–¥–∞–ª—è–π—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∫–ª—é—á–∏—Ç–µ "Fast Data Load" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

#### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**  
**–†–µ—à–µ–Ω–∏–µ:**
```m
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤
let
    ConvertToSafeType = (value as any, targetType as type) =>
        try targetType(value) otherwise 
            if targetType = type text then Text.From(value)
            else if targetType = type number then 0
            else if targetType = type date then #date(1900,1,1)
            else null
in
    ConvertToSafeType
```

#### **–ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö**
**–†–µ—à–µ–Ω–∏–µ:**
```sql  
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ROW_NUMBER –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
WITH deduplicated AS (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_name, order_date, amount 
            ORDER BY created_at DESC
        ) as rn
    FROM sales_data
)
SELECT * FROM deduplicated WHERE rn = 1;
```

#### **–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç**
**–†–µ—à–µ–Ω–∏–µ:**
```m
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
let
    ParseDate = (dateText as text) =>
        try Date.FromText(dateText, "ru-RU") otherwise
        try Date.FromText(dateText, "en-US") otherwise  
        try #date(
            Number.FromText(Text.End(dateText, 4)),
            Number.FromText(Text.Middle(dateText, 3, 2)), 
            Number.FromText(Text.Start(dateText, 2))
        ) otherwise null
in
    ParseDate
```

---

- üîô [–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 4 - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è](../chapter-04/README.md)
- üîú [–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 6 - –í—ã–±–æ—Ä–∫–∏ –∏ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã](../chapter-06/README.md)

---

- üì¢ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —á–∞—Ç—É –∫—É—Ä—Å–∞: [https://t.me/analytics_course_chat](https://t.me/analytics_course_chat)
- üì¢ –ö–∞–Ω–∞–ª –∫—É—Ä—Å–∞: [https://t.me/analytics_course_channel](https://t.me/analytics_course_channel)