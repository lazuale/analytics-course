# ‚ö° –ì–ª–∞–≤–∞ 22: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤: –∏–Ω–¥–µ–∫—Å—ã, EXPLAIN

## üéØ –¶–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–π –≥–ª–∞–≤—ã –≤—ã —Å–º–æ–∂–µ—Ç–µ:

- ‚ö° **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å SQL-–∑–∞–ø—Ä–æ—Å–æ–≤** —Å –ø–æ–º–æ—â—å—é EXPLAIN PLAN
- üîç **–í—ã—è–≤–ª—è—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞** –≤ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö
- üìä **–°–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- üéØ **–ü—Ä–∏–º–µ–Ω—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- üîÑ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL —Å DAX** –≤ Power BI
- üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ë–î

---

## üìö –¢–µ–æ—Ä–∏—è

### ‚ö° –û—Å–Ω–æ–≤—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –ì–æ—Ä–æ–¥—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ SQL-–∑–∞–ø—Ä–æ—Å ‚Äî —ç—Ç–æ –º–∞—Ä—à—Ä—É—Ç –ø–æ –≥–æ—Ä–æ–¥—É, –∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è —Å–µ—Ç—å:

- **–¢–∞–±–ª–∏—Ü—ã** ‚Äî —ç—Ç–æ —Ä–∞–π–æ–Ω—ã –≥–æ—Ä–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ—Å–µ—Ç–∏—Ç—å
- **–ò–Ω–¥–µ–∫—Å—ã** ‚Äî —ç—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç–Ω—ã–µ –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏ –∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏
- **EXPLAIN PLAN** ‚Äî —ç—Ç–æ GPS-–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –ª—É—á—à–∏–π –º–∞—Ä—à—Ä—É—Ç
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî —ç—Ç–æ –≤—ã–±–æ—Ä —Å–∞–º–æ–≥–æ –±—ã—Å—Ç—Ä–æ–≥–æ –ø—É—Ç–∏ –±–µ–∑ –ø—Ä–æ–±–æ–∫
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü** ‚Äî —ç—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ—Ä–æ–≥

#### üöó –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤

–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä SQL ‚Äî —ç—Ç–æ –∫–∞–∫ —É–º–Ω—ã–π GPS-–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä:

1. **–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞** ‚Äî –∏–∑—É—á–∞–µ—Ç, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±—Ä–∞—Ç—å—Å—è
2. **–û—Ü–µ–Ω–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤** ‚Äî —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
3. **–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏** ‚Äî –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏
4. **–í—ã–±–æ—Ä –ø–ª–∞–Ω–∞** ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –º–∞—Ä—à—Ä—É—Ç
5. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî —Å–ª–µ–¥—É–µ—Ç –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É

```sql
-- –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å–ø–æ—Å–æ–±–æ–≤
SELECT p.product_name, SUM(s.quantity) as total_sold
FROM products p
JOIN sales s ON p.product_id = s.product_id
WHERE p.category = 'Electronics'
  AND s.sale_date >= '2024-01-01'
GROUP BY p.product_name;

-- –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –≤—ã–±–µ—Ä–µ—Ç –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
-- 1. –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å products, –ø–æ—Ç–æ–º JOIN
-- 2. –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å sales, –ø–æ—Ç–æ–º JOIN
-- 3. –°–¥–µ–ª–∞—Ç—å JOIN, –ø–æ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
```

---

### üîç EXPLAIN PLAN: GPS –¥–ª—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞
EXPLAIN PLAN ‚Äî —ç—Ç–æ –∫–∞–∫ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –æ—Ç GPS, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ö–∞–∫–∏–º–∏ –¥–æ—Ä–æ–≥–∞–º–∏ –≤—ã –ø–æ–µ–¥–µ—Ç–µ (–∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)
- –í –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π)
- –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–æ–∫ (—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π)
- –ï—Å—Ç—å –ª–∏ –ø—Ä–æ–±–∫–∏ –Ω–∞ –ø—É—Ç–∏ (—É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

#### üìä –ß—Ç–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø–ª–∞–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
EXPLAIN QUERY PLAN
SELECT c.customer_name, COUNT(o.order_id) as order_count
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE c.city = '–ú–æ—Å–∫–≤–∞'
GROUP BY c.customer_id, c.customer_name
ORDER BY order_count DESC;
```

**–¢–∏–ø–∏—á–Ω—ã–π –≤—ã–≤–æ–¥ EXPLAIN:**
```
SCAN customers USING INDEX idx_customers_city (city=?)
SEARCH orders USING INDEX idx_orders_customer_id (customer_id=?)
USE TEMP B-TREE FOR GROUP BY
USE TEMP B-TREE FOR ORDER BY
```

**2Ô∏è‚É£ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ –ø–ª–∞–Ω–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

| –û–ø–µ—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–Ω–∞–ª–æ–≥–∏—è |
|----------|----------|----------|
| **SCAN** | –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã | –û–±—ä–µ–∑–¥ –≤—Å–µ–≥–æ —Ä–∞–π–æ–Ω–∞ |
| **SEARCH** | –ü–æ–∏—Å–∫ —Å –∏–Ω–¥–µ–∫—Å–æ–º | –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –¥–æ—Ä–æ–≥–µ |
| **NESTED LOOP** | –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã | –ü–æ—Å–µ—â–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–∞ –Ω–∞ –∫–∞–∂–¥–æ–π —É–ª–∏—Ü–µ |
| **HASH JOIN** | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—É | –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π |
| **SORT** | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –í—ã—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å |
| **GROUP BY** | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ | –°–±–æ—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º |

**3Ô∏è‚É£ –ê–Ω–∞–ª–∏–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π:**

```sql
-- –í PostgreSQL –∏–ª–∏ SQL Server –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
EXPLAIN (ANALYZE, BUFFERS)
SELECT p.product_name, AVG(r.rating) as avg_rating
FROM products p
JOIN reviews r ON p.product_id = r.product_id
WHERE p.price BETWEEN 1000 AND 5000
GROUP BY p.product_id, p.product_name
HAVING COUNT(r.review_id) >= 10;

/*
–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
HashAggregate (cost=15234.56..15456.78 rows=1000 width=32)
  -> Hash Join (cost=1234.56..12345.67 rows=5000 width=28)
    Hash Cond: (p.product_id = r.product_id)
    -> Seq Scan on products p (cost=0.00..456.78 rows=2000 width=20)
      Filter: (price >= 1000 AND price <= 5000)
    -> Hash (cost=789.01..789.01 rows=10000 width=12)
      -> Seq Scan on reviews r (cost=0.00..789.01 rows=10000 width=12)
*/
```

---

### üìä –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –ë–∏–±–ª–∏–æ—Ç–µ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
–ò–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –≤ –æ–≥—Ä–æ–º–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:

- **–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥** (B-Tree –∏–Ω–¥–µ–∫—Å) ‚Äî –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø–æ —Ñ–∞–º–∏–ª–∏–∏ –∞–≤—Ç–æ—Ä–∞
- **–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥** (–∏–Ω–¥–µ–∫—Å –ø–æ –∂–∞–Ω—Ä—É) ‚Äî –Ω–∞–π—Ç–∏ –≤—Å–µ –∫–Ω–∏–≥–∏ –ø–æ —Ç–µ–º–µ
- **–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥** (–∏–Ω–¥–µ–∫—Å –ø–æ –¥–∞—Ç–µ) ‚Äî –Ω–∞–π—Ç–∏ –∫–Ω–∏–≥–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≥–æ–¥–∞
- **–°–æ—Å—Ç–∞–≤–Ω–æ–π –∫–∞—Ç–∞–ª–æ–≥** (—Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å) ‚Äî –Ω–∞–π—Ç–∏ –ø–æ –∞–≤—Ç–æ—Ä—É –ò –≥–æ–¥—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

#### üå≥ B-Tree –∏–Ω–¥–µ–∫—Å—ã: –û—Å–Ω–æ–≤–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**1Ô∏è‚É£ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç B-Tree –∏–Ω–¥–µ–∫—Å:**

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ B-Tree –∏–Ω–¥–µ–∫—Å–∞
CREATE INDEX idx_products_name ON products(product_name);

-- –≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å —É—Å–∫–æ—Ä—è–µ—Ç —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:
SELECT * FROM products WHERE product_name = 'iPhone 15';
SELECT * FROM products WHERE product_name LIKE 'iPhone%';
SELECT * FROM products ORDER BY product_name;
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ B-Tree:**
```
                   [M-T]
                 /       \
            [A-F]           [U-Z]
           /     \         /     \
       [A-C]   [G-L]   [U-W]   [X-Z]
       / | \   / | \   / | \   / | \
     A B C   G H L   U V W   X Y Z
```

**2Ô∏è‚É£ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**

```sql
-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å—Ç–æ–ª–±—Ü–∞–º
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);

-- –≠—Ç–æ—Ç –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è:
-- ‚úÖ WHERE customer_id = 123
-- ‚úÖ WHERE customer_id = 123 AND order_date = '2024-01-01'
-- ‚úÖ WHERE customer_id = 123 AND order_date >= '2024-01-01'

-- –ù–æ –ù–ï —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è:
-- ‚ùå WHERE order_date = '2024-01-01' (–±–µ–∑ customer_id)
```

**–ü—Ä–∞–≤–∏–ª–æ –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã:** –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–∫–ª—é—á–∞–µ—Ç –ª–µ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã –∏–Ω–¥–µ–∫—Å–∞.

**3Ô∏è‚É£ –ü–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**

```sql
-- –ü–æ–∫—Ä—ã–≤–∞—é—â–∏–π –∏–Ω–¥–µ–∫—Å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã
CREATE INDEX idx_products_covering 
ON products(category, price, product_name, description);

-- –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
SELECT product_name, price 
FROM products 
WHERE category = 'Electronics' 
  AND price BETWEEN 500 AND 1500;
```

#### üìà –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

**1Ô∏è‚É£ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è WHERE —É—Å–ª–æ–≤–∏–π:**

```sql
-- –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_customers_email ON customers(email);
SELECT * FROM customers WHERE email = 'john@example.com';

-- –î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
CREATE INDEX idx_products_price ON products(price);
SELECT * FROM products WHERE price BETWEEN 1000 AND 2000;

-- –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–æ–∫–∏
CREATE INDEX idx_products_name ON products(product_name);
SELECT * FROM products WHERE product_name LIKE 'iPhone%';
```

**2Ô∏è‚É£ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π:**

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);

-- –£—Å–∫–æ—Ä—è—é—Ç JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏
SELECT c.customer_name, COUNT(o.order_id)
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;
```

**3Ô∏è‚É£ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è ORDER BY –∏ GROUP BY:**

```sql
-- –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
CREATE INDEX idx_products_name_price ON products(product_name, price);
SELECT * FROM products ORDER BY product_name, price;

-- –î–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
CREATE INDEX idx_sales_date_product ON sales(sale_date, product_id);
SELECT product_id, SUM(amount)
FROM sales 
WHERE sale_date >= '2024-01-01'
GROUP BY product_id;
```

#### ‚ö†Ô∏è –ö–æ–≥–¥–∞ –∏–Ω–¥–µ–∫—Å—ã –º–æ–≥—É—Ç –Ω–∞–≤—Ä–µ–¥–∏—Ç—å

**1Ô∏è‚É£ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤:**
- –ó–∞–º–µ–¥–ª—è—é—Ç INSERT, UPDATE, DELETE –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ó–∞–Ω–∏–º–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- –£—Å–ª–æ–∂–Ω—è—é—Ç –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä—É

**2Ô∏è‚É£ –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ (PostgreSQL)
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,           -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
    idx_tup_read,       -- –ø—Ä–æ—á–∏—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫
    idx_tup_fetch       -- –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ —Å—Ç—Ä–æ–∫
FROM pg_stat_user_indexes
WHERE idx_scan = 0      -- –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
ORDER BY schemaname, tablename;
```

**3Ô∏è‚É£ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- –ü–õ–û–•–û: –∏–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–ª–±–µ—Ü —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
CREATE INDEX bad_idx_gender ON users(gender); -- —Ç–æ–ª—å–∫–æ M/F

-- –ü–õ–û–•–û: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ WHERE –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
SELECT * FROM customers WHERE UPPER(email) = 'JOHN@EXAMPLE.COM';
-- –õ—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å: CREATE INDEX idx_email_upper ON customers(UPPER(email));
```

---

### üéØ –ú–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî —ç—Ç–æ –∫–∞–∫ —Ç—é–Ω–∏–Ω–≥ –≥–æ–Ω–æ—á–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è:
- **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî –∑–∞–º–µ—Ä—ã –Ω–∞ —Ç—Ä–∞—Å—Å–µ
- **–í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç** ‚Äî –ø–æ–∏—Å–∫ —Å–ª–∞–±—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–¢–æ—á–µ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** ‚Äî –∑–∞–º–µ–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π** ‚Äî –Ω–æ–≤—ã–µ –∑–∞–º–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è WHERE —É—Å–ª–æ–≤–∏–π

**1Ô∏è‚É£ –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–æ–≤:**

```sql
-- –ü–õ–û–•–û: –Ω–µ—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —Å–Ω–∞—á–∞–ª–∞
SELECT * FROM customers 
WHERE country = 'Russia'           -- 80% –∑–∞–ø–∏—Å–µ–π
  AND premium_status = 'VIP'       -- 1% –∑–∞–ø–∏—Å–µ–π
  AND registration_date >= '2024-01-01';

-- –•–û–†–û–®–û: —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã —Å–Ω–∞—á–∞–ª–∞  
SELECT * FROM customers 
WHERE premium_status = 'VIP'       -- 1% –∑–∞–ø–∏—Å–µ–π (—Å–∞–º—ã–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π)
  AND registration_date >= '2024-01-01'  -- 10% –∑–∞–ø–∏—Å–µ–π
  AND country = 'Russia';          -- 80% –∑–∞–ø–∏—Å–µ–π
```

**2Ô∏è‚É£ –ò–∑–±–µ–≥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –≤ WHERE:**

```sql
-- –ü–õ–û–•–û: —Ñ—É–Ω–∫—Ü–∏—è –≤ WHERE –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
SELECT * FROM orders 
WHERE YEAR(order_date) = 2024;

-- –•–û–†–û–®–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2025-01-01';

-- –ü–õ–û–•–û: –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ WHERE
SELECT * FROM products 
WHERE price * 1.2 > 1000;

-- –•–û–†–û–®–û: –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏
SELECT * FROM products 
WHERE price > 1000 / 1.2;
```

**3Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LIKE –æ–ø–µ—Ä–∞—Ü–∏–π:**

```sql
-- –•–û–†–û–®–û: –ø–æ–∏—Å–∫ –ø–æ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å
SELECT * FROM customers 
WHERE customer_name LIKE '–ü–µ—Ç—Ä%';

-- –ü–õ–û–•–û: –ø–æ–∏—Å–∫ —Å % –≤ –Ω–∞—á–∞–ª–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å
SELECT * FROM customers 
WHERE customer_name LIKE '%–ü–µ—Ç—Ä%';

-- –†–µ—à–µ–Ω–∏–µ: –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_customers_name_gin 
ON customers USING gin(to_tsvector('russian', customer_name));
```

#### üîÑ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π

**1Ô∏è‚É£ –ü–æ—Ä—è–¥–æ–∫ JOIN:**

```sql
-- –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –æ–±—ã—á–Ω–æ —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–º–æ—á—å:

-- –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–∞–º–æ–π –º–∞–ª–µ–Ω—å–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT p.product_name, c.category_name, SUM(s.quantity)
FROM categories c                    -- 10 –∑–∞–ø–∏—Å–µ–π (–Ω–∞—á–∏–Ω–∞–µ–º —Å –º–∞–ª–æ–π)
JOIN products p ON c.category_id = p.category_id     -- 1,000 –∑–∞–ø–∏—Å–µ–π  
JOIN sales s ON p.product_id = s.product_id         -- 1,000,000 –∑–∞–ø–∏—Å–µ–π
WHERE c.category_name = 'Electronics'
GROUP BY p.product_id, p.product_name, c.category_name;
```

**2Ô∏è‚É£ –¢–∏–ø—ã JOIN –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤:**

```sql
-- NESTED LOOP JOIN - —Ö–æ—Ä–æ—à –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
-- HASH JOIN - —Ö–æ—Ä–æ—à –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
-- MERGE JOIN - —Ö–æ—Ä–æ—à –¥–ª—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

-- –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø JOIN (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –°–£–ë–î)
SELECT /*+ USE_HASH(c, p) */ 
       c.customer_name, 
       COUNT(p.purchase_id)
FROM customers c
JOIN purchases p ON c.customer_id = p.customer_id;
```

**3Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤:**

```sql
-- –ü–õ–û–•–û: –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å
SELECT c.customer_name
FROM customers c
WHERE (SELECT COUNT(*) 
       FROM orders o 
       WHERE o.customer_id = c.customer_id) > 5;

-- –•–û–†–û–®–û: JOIN —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
SELECT c.customer_name
FROM customers c
JOIN (
    SELECT customer_id, COUNT(*) as order_count
    FROM orders
    GROUP BY customer_id
    HAVING COUNT(*) > 5
) o ON c.customer_id = o.customer_id;

-- –ï–©–ï –õ–£–ß–®–ï: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ EXISTS
SELECT c.customer_name
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id
    GROUP BY o.customer_id
    HAVING COUNT(*) > 5
);
```

#### üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GROUP BY –∏ ORDER BY

**1Ô∏è‚É£ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**

```sql
-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è GROUP BY
CREATE INDEX idx_sales_product_date ON sales(product_id, sale_date);

-- –¢–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä—ã–º
SELECT product_id, DATE_TRUNC('month', sale_date), SUM(amount)
FROM sales
WHERE sale_date >= '2024-01-01'
GROUP BY product_id, DATE_TRUNC('month', sale_date);
```

**2Ô∏è‚É£ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**

```sql
-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LIMIT —Å ORDER BY –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
SELECT customer_name, total_purchases
FROM customer_stats
ORDER BY total_purchases DESC
LIMIT 100;  -- –¢–æ–ª—å–∫–æ —Ç–æ–ø-100, –Ω–µ –≤—Å–µ –∑–∞–ø–∏—Å–∏

-- –ò–∑–±–µ–≥–∞–π—Ç–µ ORDER BY –±–µ–∑ LIMIT –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
-- –ü–õ–û–•–û –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–æ–≤ –∑–∞–ø–∏—Å–µ–π:
SELECT * FROM large_table ORDER BY some_column;
```

---

### üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SQL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å DAX

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –î–≤—É—Ö—ç—Ç–∞–∂–Ω—ã–π –¥–æ–º
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫–∞–∫ –¥–≤—É—Ö—ç—Ç–∞–∂–Ω—ã–π –¥–æ–º:
- **–ü–µ—Ä–≤—ã–π —ç—Ç–∞–∂ (SQL)** ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è, –≥–¥–µ –∂–∏–≤—É—Ç –¥–∞–Ω–Ω—ã–µ
- **–í—Ç–æ—Ä–æ–π —ç—Ç–∞–∂ (DAX –≤ Power BI)** ‚Äî –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- **–õ–µ—Å—Ç–Ω–∏—Ü–∞** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É SQL –∏ DAX
- **–õ–∏—Ñ—Ç** ‚Äî —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ

#### üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL –¥–ª—è Power BI

**1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π:**

```sql
-- –°–æ–∑–¥–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Power BI
CREATE MATERIALIZED VIEW sales_summary AS
SELECT 
    DATE_TRUNC('month', s.sale_date) as sale_month,
    p.category_id,
    c.category_name,
    p.product_id,
    p.product_name,
    SUM(s.quantity) as total_quantity,
    SUM(s.amount) as total_amount,
    COUNT(s.sale_id) as transaction_count,
    COUNT(DISTINCT s.customer_id) as unique_customers
FROM sales s
JOIN products p ON s.product_id = p.product_id
JOIN categories c ON p.category_id = c.category_id
WHERE s.sale_date >= DATE_TRUNC('year', CURRENT_DATE - INTERVAL '2 years')
GROUP BY 
    DATE_TRUNC('month', s.sale_date),
    p.category_id,
    c.category_name, 
    p.product_id,
    p.product_name;

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
CREATE INDEX idx_sales_summary_month_category 
ON sales_summary(sale_month, category_id);
```

**2Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è DirectQuery —Ä–µ–∂–∏–º–∞:**

```sql
-- –í DirectQuery –∫–∞–∂–¥—ã–π –≤–∏–∑—É–∞–ª Power BI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å
-- –ù—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ Power BI
CREATE INDEX idx_sales_date_customer ON sales(sale_date, customer_id);
CREATE INDEX idx_products_category_price ON products(category_id, price);
CREATE INDEX idx_customers_city_segment ON customers(city, customer_segment);

-- –°–æ–∑–¥–∞–µ–º –∫–æ–ª–æ–Ω–æ—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
CREATE COLUMNSTORE INDEX idx_sales_columnstore 
ON sales(sale_date, product_id, customer_id, amount, quantity);
```

#### üìà DAX –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å —É—á–µ—Ç–æ–º SQL

**1Ô∏è‚É£ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ DAX –º–µ—Ä—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö SQL –¥–∞–Ω–Ω—ã—Ö:**

```dax
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ SQL
Total Sales = SUM(sales_summary[total_amount])

// –í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ DAX, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ SQL –¥–∞–Ω–Ω—ã–µ
Monthly Growth = 
VAR CurrentMonth = [Total Sales]
VAR PrevMonth = 
    CALCULATE(
        [Total Sales],
        DATEADD(sales_summary[sale_month], -1, MONTH)
    )
RETURN
    DIVIDE(CurrentMonth - PrevMonth, PrevMonth)

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç SQL –∏–Ω–¥–µ–∫—Å—ã
Top Products by Category = 
CALCULATE(
    [Total Sales],
    TOPN(10, 
         VALUES(sales_summary[product_name]), 
         [Total Sales], 
         DESC)
)
```

**2Ô∏è‚É£ –ò–∑–±–µ–≥–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö DAX –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:**

```dax
// –ü–õ–û–•–û: —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ DAX, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é —Ç–∞–±–ª–∏—Ü—É
Customers with High AOV = 
SUMX(
    VALUES(customers[customer_id]),
    IF(
        DIVIDE(
            SUM(RELATED(sales[amount])),
            COUNT(RELATED(sales[sale_id]))
        ) > 1000,
        1,
        0
    )
)

// –•–û–†–û–®–û: –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ SQL
High AOV Customers = SUM(customer_stats[is_high_aov])

-- –ì–¥–µ customer_stats —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ SQL:
CREATE VIEW customer_stats AS
SELECT 
    customer_id,
    AVG(amount) as avg_order_value,
    CASE WHEN AVG(amount) > 1000 THEN 1 ELSE 0 END as is_high_aov
FROM sales
GROUP BY customer_id;
```

#### üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∫–∏ SQL-DAX

**1Ô∏è‚É£ –ê–Ω–∞–ª–∏–∑ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Power BI:**

```sql
-- –í–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (PostgreSQL)
ALTER SYSTEM SET log_statement = 'all';
ALTER SYSTEM SET log_min_duration_statement = 1000; -- –∑–∞–ø—Ä–æ—Å—ã > 1 —Å–µ–∫

-- –ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    rows
FROM pg_stat_statements 
WHERE query LIKE '%sales%'
ORDER BY mean_time DESC;
```

**2Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö Power BI:**

```dax
// –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Å–≤—è–∑–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏
// –ò—Å–ø–æ–ª—å–∑—É–µ–º Integer –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
Calendar = 
ADDCOLUMNS(
    CALENDARAUTO(),
    "Year", YEAR([Date]),
    "Month", MONTH([Date]),
    "Quarter", "Q" & FORMAT(ROUNDUP(MONTH([Date])/3,0),"0"),
    "MonthYear", FORMAT([Date], "MMM YYYY")
)

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
// –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
```

---

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### üé≠ –ú–µ—Ç–∞—Ñ–æ—Ä–∞: –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã:
- **–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏–º–ø—Ç–æ–º–æ–≤** ‚Äî –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω —Å–Ω–∏–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–õ–µ—á–µ–Ω–∏–µ** ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- **–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –æ—Å–º–æ—Ç—Ä—ã** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ª–µ—á–µ–Ω–∏—è

#### üìà –°–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**1Ô∏è‚É£ –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```sql
-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
SELECT 
    'Database Size' as metric,
    pg_size_pretty(pg_database_size(current_database())) as value
UNION ALL
SELECT 
    'Active Connections' as metric,
    COUNT(*)::text as value
FROM pg_stat_activity
WHERE state = 'active'
UNION ALL
SELECT 
    'Cache Hit Ratio' as metric,
    ROUND(
        100.0 * sum(blks_hit) / nullif(sum(blks_hit) + sum(blks_read), 0), 
        2
    )::text || '%' as value
FROM pg_stat_database;
```

**2Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE TABLE query_performance_log (
    log_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    query_type VARCHAR(50),
    execution_time_ms INTEGER,
    rows_affected INTEGER,
    query_text TEXT
);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
-- (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –°–£–ë–î)
```

#### üîß –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

**1Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫:**

```sql
-- –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
ANALYZE; -- PostgreSQL
-- –∏–ª–∏
UPDATE STATISTICS; -- SQL Server
-- –∏–ª–∏
EXEC DBMS_STATS.GATHER_DATABASE_STATS; -- Oracle
```

**2Ô∏è‚É£ –†–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ –¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è:**

```sql
-- –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
REINDEX INDEX idx_sales_date; -- PostgreSQL

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ (SQL Server)
SELECT 
    i.name as index_name,
    s.avg_fragmentation_in_percent,
    s.page_count
FROM sys.dm_db_index_physical_stats(DB_ID(), NULL, NULL, NULL, 'LIMITED') s
JOIN sys.indexes i ON s.object_id = i.object_id AND s.index_id = i.index_id
WHERE s.avg_fragmentation_in_percent > 30;
```

**3Ô∏è‚É£ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

```sql
-- –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∞—Ç–∞–º
CREATE TABLE sales_2024 PARTITION OF sales 
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π
DROP TABLE sales_2022; -- –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–≠—Ç–∞ –≥–ª–∞–≤–∞ –ø–æ—Å–≤—è—â–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–º—É –Ω–∞–≤—ã–∫—É ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤. –í—ã –∏–∑—É—á–∏—Ç–µ, –∫–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é SQL —Å DAX –≤ Power BI.

–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –æ–Ω–∏ –ø–æ–∫–∞–∂—É—Ç —Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

- üìù [–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏—è–º](practice.md)
- ‚úÖ [–ü–µ—Ä–µ–π—Ç–∏ –∫ —á–µ–∫-–ª–∏—Å—Ç—É](checklist.md)
- üìÅ [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—á–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã](files/README.md)

---

- üîô [–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 21: - –†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–¥–µ–∫—Å—ã](../chapter-21/README.md)
- üîú [–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 23: –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: storytelling, –æ—Ç—á—ë—Ç—ã](../chapter-23/README.md)

---

- üì¢ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —á–∞—Ç—É –∫—É—Ä—Å–∞: https://t.me/analytics_course_chat
- üì¢ –ö–∞–Ω–∞–ª –∫—É—Ä—Å–∞: https://t.me/analytics_course_channel