# üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –≥–ª–∞–≤—ã 19

üìñ [–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏](../README.md) | üìÅ [–£—á–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã](../files/README.md) | ‚úÖ [–ß–µ–∫-–ª–∏—Å—Ç](../checklist.md)

## üéØ –û–±–∑–æ—Ä –∑–∞–¥–∞–Ω–∏–π

–í —ç—Ç–æ–π –≥–ª–∞–≤–µ –≤—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ **5 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π** –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç–∞—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞:

1. **üìä –ë–∞–∑–æ–≤—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º SQL  
2. **üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** ‚Äî WHERE, ORDER BY, LIKE
3. **üìà –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî COUNT, SUM, AVG, GROUP BY, HAVING
4. **üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü** ‚Äî INNER JOIN, LEFT JOIN, –∞–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π
5. **üöÄ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑** ‚Äî –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Power Query

**‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 6-8 —á–∞—Å–æ–≤  
**üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å SQL –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 1: –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å SQL –∏ –±–∞–∑–æ–≤—ã–µ SELECT

**üéØ –¶–µ–ª—å:** –û—Å–≤–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQL –∏ –ø—Ä–æ—Å—Ç—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã

**üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** SQLite DB Browser, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**‚è±Ô∏è –í—Ä–µ–º—è:** 60 –º–∏–Ω—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

1. –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **DB Browser for SQLite** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `ecommerce_database.db` –∏–∑ –ø–∞–ø–∫–∏ files/
3. –ò–∑—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ "Database Structure"

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- `customers` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö
- `orders` ‚Äî –∑–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤  
- `order_items` ‚Äî —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–∞—Ö
- `products` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
- `categories` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

#### 2Ô∏è‚É£ –ò–∑—É—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–≤—ã–µ 10 –∑–∞–ø–∏—Å–µ–π –∏–∑ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT * FROM customers LIMIT 10;
SELECT * FROM orders LIMIT 10;
SELECT * FROM order_items LIMIT 10;
SELECT * FROM products LIMIT 10;
SELECT * FROM categories LIMIT 10;

-- –£–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
SELECT COUNT(*) as customers_count FROM customers;
SELECT COUNT(*) as orders_count FROM orders;
SELECT COUNT(*) as order_items_count FROM order_items;
SELECT COUNT(*) as products_count FROM products;
SELECT COUNT(*) as categories_count FROM categories;
```

#### 3Ô∏è‚É£ –ü—Ä–æ—Å—Ç—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã

```sql
-- –ó–∞–¥–∞—á–∞ 1.1: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –ú–æ—Å–∫–≤—ã
SELECT customer_id, first_name, last_name, email, city
FROM customers
WHERE city = '–ú–æ—Å–∫–≤–∞';

-- –ó–∞–¥–∞—á–∞ 1.2: –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö, —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—É—é –ø–æ —Ñ–∞–º–∏–ª–∏–∏
SELECT customer_id, first_name, last_name, registration_date
FROM customers
ORDER BY last_name, first_name;

-- –ó–∞–¥–∞—á–∞ 1.3: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ—Ä–æ–∂–µ 5000 —Ä—É–±–ª–µ–π
SELECT product_id, product_name, price, category_id
FROM products
WHERE price > 5000
ORDER BY price DESC;
```

#### 4Ô∏è‚É£ –†–∞–±–æ—Ç–∞ —Å –≤—ã—á–∏—Å–ª—è–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏

```sql
-- –ó–∞–¥–∞—á–∞ 1.4: –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö
SELECT 
    product_name,
    price,
    price * 0.2 AS vat_amount,              -- –ù–î–° 20%
    price * 1.2 AS price_with_vat,          -- –¶–µ–Ω–∞ —Å –ù–î–°
    CASE 
        WHEN price < 1000 THEN '–ë—é–¥–∂–µ—Ç–Ω—ã–π'
        WHEN price < 5000 THEN '–°—Ä–µ–¥–Ω–∏–π'
        ELSE '–ü—Ä–µ–º–∏—É–º'
    END AS price_category
FROM products
WHERE category_id IN (1, 2, 3)             -- –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
ORDER BY price;

-- –ó–∞–¥–∞—á–∞ 1.5: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
SELECT 
    customer_id,
    first_name || ' ' || last_name AS full_name,  -- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏
    email,
    city,
    UPPER(city) AS city_uppercase,              -- –ì–æ—Ä–æ–¥ –±–æ–ª—å—à–∏–º–∏ –±—É–∫–≤–∞–º–∏
    LENGTH(email) AS email_length,              -- –î–ª–∏–Ω–∞ email
    DATE('now') AS current_date,                -- –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
    julianday('now') - julianday(registration_date) AS days_since_registration
FROM customers
WHERE city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å')
ORDER BY days_since_registration DESC;
```

#### 5Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ –∏—Ç–æ–≥–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∂–µ—Ç:

```sql
-- –ó–∞–¥–∞—á–∞ 1.6: –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
SELECT 
    '–ö–ª–∏–µ–Ω—Ç—ã' AS entity_type,
    COUNT(*) AS total_count,
    NULL AS avg_value,
    NULL AS min_value,
    NULL AS max_value
FROM customers

UNION ALL

SELECT 
    '–ó–∞–∫–∞–∑—ã' AS entity_type,
    COUNT(*) AS total_count,
    ROUND(AVG(total_amount), 2) AS avg_value,
    MIN(total_amount) AS min_value,
    MAX(total_amount) AS max_value
FROM orders

UNION ALL

SELECT 
    '–¢–æ–≤–∞—Ä—ã' AS entity_type,
    COUNT(*) AS total_count,
    ROUND(AVG(price), 2) AS avg_value,
    MIN(price) AS min_value,
    MAX(price) AS max_value
FROM products;
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –£–º–µ–Ω–∏–µ –ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ SELECT –∑–∞–ø—Ä–æ—Å—ã
- –ù–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –≤—ã—á–∏—Å–ª—è–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –ü–µ—Ä–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –Ω–∞ SQL

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 2: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**üéØ –¶–µ–ª—å:** –û—Å–≤–æ–∏—Ç—å WHERE —É—Å–ª–æ–≤–∏—è, LIKE –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Å–ª–æ–∂–Ω—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É

**üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** SQLite DB Browser

**‚è±Ô∏è –í—Ä–µ–º—è:** 75 –º–∏–Ω—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### 1Ô∏è‚É£ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

```sql
-- –ó–∞–¥–∞—á–∞ 2.1: –ö–ª–∏–µ–Ω—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
-- –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∂–µ–Ω—Å–∫–æ–≥–æ –ø–æ–ª–∞ –∏–∑ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
SELECT customer_id, first_name, last_name, city, gender
FROM customers
WHERE gender = 'F' 
  AND city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥')
ORDER BY city, last_name;

-- –ó–∞–¥–∞—á–∞ 2.2: –ó–∞–∫–∞–∑—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç –∏ —Å—É–º–º
SELECT order_id, customer_id, order_date, total_amount
FROM orders
WHERE order_date BETWEEN '2024-03-01' AND '2024-03-31'
  AND total_amount BETWEEN 5000 AND 25000
ORDER BY total_amount DESC;

-- –ó–∞–¥–∞—á–∞ 2.3: –¢–æ–≤–∞—Ä—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
SELECT product_name, price, category_id, stock_quantity
FROM products
WHERE stock_quantity > 0                    -- –ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏
  AND price < 10000                         -- –î–æ—Å—Ç—É–ø–Ω–∞—è —Ü–µ–Ω–∞
  AND category_id NOT IN (5, 6)            -- –ò—Å–∫–ª—é—á–∞–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
ORDER BY category_id, price;
```

#### 2Ô∏è‚É£ –†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ LIKE

```sql
-- –ó–∞–¥–∞—á–∞ 2.4: –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —á–∞—Å—Ç–∏ –∏–º–µ–Ω–∏ –∏–ª–∏ email
-- –ö–ª–∏–µ–Ω—Ç—ã —Å –∏–º–µ–Ω–µ–º, –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è –Ω–∞ "–ê"
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE first_name LIKE '–ê%'
ORDER BY first_name;

-- –ö–ª–∏–µ–Ω—Ç—ã —Å email –æ—Ç Gmail
SELECT customer_id, first_name, last_name, email
FROM customers
WHERE email LIKE '%@gmail.com'
ORDER BY last_name;

-- –ó–∞–¥–∞—á–∞ 2.5: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
SELECT product_id, product_name, description, price
FROM products
WHERE description LIKE '%—Ç–µ–ª–µ—Ñ–æ–Ω%' 
   OR description LIKE '%—Å–º–∞—Ä—Ç—Ñ–æ–Ω%'
   OR product_name LIKE '%iPhone%'
   OR product_name LIKE '%Samsung%'
ORDER BY price DESC;

-- –ó–∞–¥–∞—á–∞ 2.6: –ö–ª–∏–µ–Ω—Ç—ã —Å —Ñ–∞–º–∏–ª–∏—è–º–∏, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–º–∏—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã
SELECT customer_id, first_name, last_name, city
FROM customers
WHERE last_name LIKE '%–æ–≤' 
   OR last_name LIKE '%–µ–≤' 
   OR last_name LIKE '%–∏–Ω'
   OR last_name LIKE '%—Å–∫–∏–π'
ORDER BY last_name;
```

#### 3Ô∏è‚É£ –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º

```sql
-- –ó–∞–¥–∞—á–∞ 2.7: –ê–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
-- –ó–∞–∫–∞–∑—ã, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏
SELECT 
    order_id,
    customer_id,
    order_date,
    CASE strftime('%w', order_date)
        WHEN '0' THEN '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'
        WHEN '1' THEN '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'
        WHEN '2' THEN '–í—Ç–æ—Ä–Ω–∏–∫'
        WHEN '3' THEN '–°—Ä–µ–¥–∞'
        WHEN '4' THEN '–ß–µ—Ç–≤–µ—Ä–≥'
        WHEN '5' THEN '–ü—è—Ç–Ω–∏—Ü–∞'
        WHEN '6' THEN '–°—É–±–±–æ—Ç–∞'
    END AS day_of_week,
    total_amount
FROM orders
WHERE strftime('%w', order_date) IN ('0', '6')  -- –°—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
ORDER BY order_date DESC;

-- –ó–∞–¥–∞—á–∞ 2.8: –ó–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π
SELECT 
    order_id,
    customer_id,
    order_date,
    total_amount,
    julianday('now') - julianday(order_date) AS days_ago
FROM orders
WHERE julianday('now') - julianday(order_date) <= 90
ORDER BY order_date DESC;

-- –ó–∞–¥–∞—á–∞ 2.9: –ö–ª–∏–µ–Ω—Ç—ã, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
SELECT 
    customer_id,
    first_name,
    last_name,
    registration_date,
    strftime('%Y-%m', registration_date) AS registration_month
FROM customers
WHERE registration_date >= '2023-01-01' 
  AND registration_date < '2024-01-01'
ORDER BY registration_date;
```

#### 4Ô∏è‚É£ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏

```sql
-- –ó–∞–¥–∞—á–∞ 2.10: –°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å AND, OR, NOT
-- VIP –∫–ª–∏–µ–Ω—Ç—ã: –∂–µ–Ω—â–∏–Ω—ã –∏–∑ –ú–æ—Å–∫–≤—ã –ò–õ–ò –º—É–∂—á–∏–Ω—ã —Å –∑–∞–∫–∞–∑–∞–º–∏ > 50000
SELECT DISTINCT
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    c.gender,
    c.email
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE (c.gender = 'F' AND c.city = '–ú–æ—Å–∫–≤–∞')
   OR (c.gender = 'M' AND o.total_amount > 50000)
ORDER BY c.last_name;

-- –ó–∞–¥–∞—á–∞ 2.11: –¢–æ–≤–∞—Ä—ã –∏—Å–∫–ª—é—á–∞—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
SELECT 
    product_id,
    product_name,
    price,
    category_id,
    stock_quantity
FROM products
WHERE NOT (price < 1000 OR stock_quantity = 0)  -- –ù–ï (–¥–µ—à–µ–≤—ã–µ –ò–õ–ò –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)
  AND category_id BETWEEN 1 AND 4
ORDER BY category_id, price;
```

#### 5Ô∏è‚É£ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

```sql
-- –ó–∞–¥–∞—á–∞ 2.12: –°–ª–æ–∂–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤
SELECT 
    o.order_id,
    c.first_name,
    c.last_name,
    c.city,
    o.order_date,
    o.total_amount,
    CASE 
        WHEN o.total_amount >= 50000 THEN '–ö—Ä—É–ø–Ω—ã–π'
        WHEN o.total_amount >= 20000 THEN '–°—Ä–µ–¥–Ω–∏–π'
        ELSE '–ú–∞–ª—ã–π'
    END AS order_size
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01'
ORDER BY 
    c.city,                    -- –°–Ω–∞—á–∞–ª–∞ –ø–æ –≥–æ—Ä–æ–¥—É
    order_size DESC,           -- –ü–æ—Ç–æ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É –∑–∞–∫–∞–∑–∞ (–∫—Ä—É–ø–Ω—ã–µ –ø–µ—Ä–≤—ã–µ)
    o.total_amount DESC,       -- –í–Ω—É—Ç—Ä–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º—ã
    o.order_date DESC;         -- –ü—Ä–∏ —Ä–∞–≤–Ω—ã—Ö —Å—É–º–º–∞—Ö –Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ

-- –ó–∞–¥–∞—á–∞ 2.13: –¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
SELECT 
    p.product_name,
    c.category_name,
    p.price,
    p.stock_quantity,
    ROUND(p.price / NULLIF(p.stock_quantity, 0), 2) AS price_per_item
FROM products p
JOIN categories c ON p.category_id = c.category_id
WHERE p.stock_quantity > 0
ORDER BY 
    c.category_name,           -- –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    p.price DESC,              -- –î–æ—Ä–æ–≥–∏–µ –ø–µ—Ä–≤—ã–µ
    p.stock_quantity DESC;     -- –ü—Ä–∏ —Ä–∞–≤–Ω–æ–π —Ü–µ–Ω–µ –±–æ–ª—å—à–µ –æ—Å—Ç–∞—Ç–∫–∞
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –£–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ WHERE —É—Å–ª–æ–≤–∏—è–º–∏
- –£–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å LIKE –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ù–∞–≤—ã–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º –∏ –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ AND, OR, NOT
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 3: –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞

**üéØ –¶–µ–ª—å:** –û—Å–≤–æ–∏—Ç—å COUNT, SUM, AVG, MIN, MAX, GROUP BY, HAVING –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** SQLite DB Browser

**‚è±Ô∏è –í—Ä–µ–º—è:** 90 –º–∏–Ω—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```sql
-- –ó–∞–¥–∞—á–∞ 3.1: –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º
SELECT 
    COUNT(*) AS total_orders,                    -- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
    COUNT(DISTINCT customer_id) AS unique_customers, -- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
    SUM(total_amount) AS total_revenue,          -- –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞
    AVG(total_amount) AS avg_order_value,        -- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
    MIN(total_amount) AS min_order,              -- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑
    MAX(total_amount) AS max_order,              -- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑
    ROUND(AVG(total_amount), 2) AS avg_rounded   -- –°—Ä–µ–¥–Ω–µ–µ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º
FROM orders;

-- –ó–∞–¥–∞—á–∞ 3.2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
SELECT 
    COUNT(*) AS total_products,
    COUNT(DISTINCT category_id) AS categories_count,
    SUM(stock_quantity) AS total_stock,
    AVG(price) AS avg_price,
    MIN(price) AS cheapest_product,
    MAX(price) AS most_expensive,
    SUM(price * stock_quantity) AS inventory_value  -- –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø–∞—Å–æ–≤
FROM products
WHERE stock_quantity > 0;  -- –¢–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏
```

#### 2Ô∏è‚É£ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—é

```sql
-- –ó–∞–¥–∞—á–∞ 3.3: –ê–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º
SELECT 
    city,
    COUNT(*) AS customers_count,
    COUNT(CASE WHEN gender = 'M' THEN 1 END) AS male_count,
    COUNT(CASE WHEN gender = 'F' THEN 1 END) AS female_count,
    ROUND(AVG(CASE WHEN gender = 'M' THEN 1.0 ELSE 0.0 END) * 100, 1) AS male_percentage
FROM customers
GROUP BY city
ORDER BY customers_count DESC;

-- –ó–∞–¥–∞—á–∞ 3.4: –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
SELECT 
    strftime('%Y-%m', order_date) AS month,
    COUNT(*) AS orders_count,
    COUNT(DISTINCT customer_id) AS unique_customers,
    SUM(total_amount) AS monthly_revenue,
    AVG(total_amount) AS avg_order_value,
    ROUND(SUM(total_amount) / COUNT(DISTINCT customer_id), 2) AS revenue_per_customer
FROM orders
WHERE order_date >= '2023-01-01'
GROUP BY strftime('%Y-%m', order_date)
ORDER BY month;

-- –ó–∞–¥–∞—á–∞ 3.5: –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
    c.category_name,
    COUNT(p.product_id) AS products_count,
    SUM(p.stock_quantity) AS total_stock,
    AVG(p.price) AS avg_price,
    MIN(p.price) AS min_price,
    MAX(p.price) AS max_price,
    SUM(p.price * p.stock_quantity) AS category_inventory_value
FROM categories c
LEFT JOIN products p ON c.category_id = p.category_id
GROUP BY c.category_id, c.category_name
ORDER BY category_inventory_value DESC;
```

#### 3Ô∏è‚É£ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º

```sql
-- –ó–∞–¥–∞—á–∞ 3.6: –ê–Ω–∞–ª–∏–∑ –ø–æ –≥–æ—Ä–æ–¥–∞–º –∏ –ø–æ–ª—É
SELECT 
    city,
    gender,
    COUNT(*) AS customers_count,
    ROUND(AVG(julianday('now') - julianday(registration_date)), 0) AS avg_days_registered
FROM customers
WHERE city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥')
GROUP BY city, gender
ORDER BY city, gender;

-- –ó–∞–¥–∞—á–∞ 3.7: –ü—Ä–æ–¥–∞–∂–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ –≥–æ—Ä–æ–¥–∞–º
SELECT 
    strftime('%Y-%m', o.order_date) AS month,
    c.city,
    COUNT(o.order_id) AS orders_count,
    SUM(o.total_amount) AS revenue,
    AVG(o.total_amount) AS avg_order_value,
    COUNT(DISTINCT o.customer_id) AS unique_customers
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01'
  AND c.city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å')
GROUP BY strftime('%Y-%m', o.order_date), c.city
ORDER BY month, revenue DESC;
```

#### 4Ô∏è‚É£ HAVING ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø

```sql
-- –ó–∞–¥–∞—á–∞ 3.8: –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (—Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤ > 3)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    COUNT(o.order_id) AS orders_count,
    SUM(o.total_amount) AS total_spent,
    AVG(o.total_amount) AS avg_order_value,
    MIN(o.order_date) AS first_order,
    MAX(o.order_date) AS last_order
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.city
HAVING COUNT(o.order_id) > 3 AND SUM(o.total_amount) > 50000
ORDER BY total_spent DESC;

-- –ó–∞–¥–∞—á–∞ 3.9: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Å –≤—ã—Ä—É—á–∫–æ–π > 500000)
SELECT 
    c.category_name,
    COUNT(DISTINCT p.product_id) AS products_count,
    COUNT(oi.order_item_id) AS items_sold,
    SUM(oi.quantity) AS total_quantity_sold,
    SUM(oi.quantity * oi.price) AS category_revenue,
    AVG(oi.price) AS avg_selling_price
FROM categories c
JOIN products p ON c.category_id = p.category_id
JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY c.category_id, c.category_name
HAVING SUM(oi.quantity * oi.price) > 500000
ORDER BY category_revenue DESC;

-- –ó–∞–¥–∞—á–∞ 3.10: –ú–µ—Å—è—Ü—ã —Å –≤—ã—Å–æ–∫–∏–º–∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏
SELECT 
    strftime('%Y-%m', order_date) AS month,
    COUNT(*) AS orders_count,
    SUM(total_amount) AS monthly_revenue,
    AVG(total_amount) AS avg_order_value
FROM orders
WHERE order_date >= '2023-01-01'
GROUP BY strftime('%Y-%m', order_date)
HAVING COUNT(*) > 100 AND SUM(total_amount) > 1000000  -- >100 –∑–∞–∫–∞–∑–æ–≤ –∏ >1–º–ª–Ω –≤—ã—Ä—É—á–∫–∏
ORDER BY monthly_revenue DESC;
```

#### 5Ô∏è‚É£ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç

```sql
-- –ó–∞–¥–∞—á–∞ 3.11: –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥–æ—Ä–æ–¥–æ–≤
SELECT 
    c.city,
    COUNT(DISTINCT c.customer_id) AS total_customers,
    COUNT(o.order_id) AS total_orders,
    ROUND(CAST(COUNT(o.order_id) AS FLOAT) / COUNT(DISTINCT c.customer_id), 2) AS orders_per_customer,
    SUM(o.total_amount) AS total_revenue,
    ROUND(SUM(o.total_amount) / COUNT(DISTINCT c.customer_id), 2) AS revenue_per_customer,
    ROUND(AVG(o.total_amount), 2) AS avg_order_value,
    COUNT(DISTINCT DATE(o.order_date)) AS active_days,
    ROUND(SUM(o.total_amount) / COUNT(DISTINCT DATE(o.order_date)), 2) AS avg_daily_revenue,
    
    -- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤ –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    CASE 
        WHEN SUM(o.total_amount) / COUNT(DISTINCT c.customer_id) > 100000 THEN '–í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'
        WHEN SUM(o.total_amount) / COUNT(DISTINCT c.customer_id) > 50000 THEN '–°—Ä–µ–¥–Ω—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'
        ELSE '–ù–∏–∑–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'
    END AS efficiency_category
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE c.city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥')
GROUP BY c.city
HAVING COUNT(o.order_id) > 0  -- –¢–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞ —Å –∑–∞–∫–∞–∑–∞–º–∏
ORDER BY revenue_per_customer DESC;

-- –ó–∞–¥–∞—á–∞ 3.12: RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
SELECT 
    customer_segment,
    COUNT(*) AS customers_count,
    AVG(days_since_last_order) AS avg_recency,
    AVG(order_frequency) AS avg_frequency,
    AVG(total_spent) AS avg_monetary
FROM (
    SELECT 
        c.customer_id,
        c.first_name,
        c.last_name,
        COUNT(o.order_id) AS order_frequency,
        SUM(o.total_amount) AS total_spent,
        julianday('now') - julianday(MAX(o.order_date)) AS days_since_last_order,
        
        -- –ü—Ä–æ—Å—Ç–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è
        CASE 
            WHEN COUNT(o.order_id) >= 5 AND SUM(o.total_amount) >= 100000 
                AND julianday('now') - julianday(MAX(o.order_date)) <= 90 
            THEN '–ß–µ–º–ø–∏–æ–Ω—ã'
            
            WHEN COUNT(o.order_id) >= 3 AND SUM(o.total_amount) >= 50000 
                AND julianday('now') - julianday(MAX(o.order_date)) <= 180 
            THEN '–õ–æ—è–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã'
            
            WHEN COUNT(o.order_id) >= 2 AND julianday('now') - julianday(MAX(o.order_date)) <= 365
            THEN '–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ'
            
            WHEN julianday('now') - julianday(MAX(o.order_date)) > 365
            THEN '–°–ø—è—â–∏–µ'
            
            ELSE '–ù–æ–≤–∏—á–∫–∏'
        END AS customer_segment
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.first_name, c.last_name
    HAVING COUNT(o.order_id) > 0  -- –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
) AS customer_analysis
GROUP BY customer_segment
ORDER BY avg_monetary DESC;
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –£–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –ù–∞–≤—ã–∫–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É WHERE –∏ HAVING
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –û–ø—ã—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–∑–Ω–µ—Å-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ SQL

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 4: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å JOIN

**üéØ –¶–µ–ª—å:** –û—Å–≤–æ–∏—Ç—å JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** SQLite DB Browser

**‚è±Ô∏è –í—Ä–µ–º—è:** 105 –º–∏–Ω—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### 1Ô∏è‚É£ –ò–∑—É—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```sql
-- –ó–∞–¥–∞—á–∞ 4.1: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–≤—è–∑–µ–π
-- –°–Ω–∞—á–∞–ª–∞ –∏–∑—É—á–∏–º —Å–≤—è–∑–∏ –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

-- –°–≤—è–∑—å customers -> orders (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
SELECT 'customers -> orders' AS relationship,
       COUNT(DISTINCT c.customer_id) AS unique_customers,
       COUNT(o.order_id) AS total_orders
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id;

-- –°–≤—è–∑—å orders -> order_items (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)  
SELECT 'orders -> order_items' AS relationship,
       COUNT(DISTINCT o.order_id) AS unique_orders,
       COUNT(oi.order_item_id) AS total_order_items
FROM orders o
LEFT JOIN order_items oi ON o.order_id = oi.order_id;

-- –°–≤—è–∑—å products -> order_items (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
SELECT 'products -> order_items' AS relationship,
       COUNT(DISTINCT p.product_id) AS unique_products,
       COUNT(oi.order_item_id) AS total_order_items
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id;

-- –°–≤—è–∑—å categories -> products (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
SELECT 'categories -> products' AS relationship,
       COUNT(DISTINCT c.category_id) AS unique_categories,
       COUNT(p.product_id) AS total_products
FROM categories c
LEFT JOIN products p ON c.category_id = p.category_id;
```

#### 2Ô∏è‚É£ INNER JOIN ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ó–∞–¥–∞—á–∞ 4.2: –ó–∞–∫–∞–∑—ã —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö
SELECT 
    o.order_id,
    c.first_name,
    c.last_name,
    c.email,
    c.city,
    o.order_date,
    o.total_amount,
    CASE 
        WHEN o.total_amount >= 50000 THEN 'VIP –∑–∞–∫–∞–∑'
        WHEN o.total_amount >= 20000 THEN '–ö—Ä—É–ø–Ω—ã–π –∑–∞–∫–∞–∑'
        ELSE '–û–±—ã—á–Ω—ã–π –∑–∞–∫–∞–∑'
    END AS order_type
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01'
ORDER BY o.total_amount DESC
LIMIT 20;

-- –ó–∞–¥–∞—á–∞ 4.3: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
SELECT 
    o.order_id,
    c.first_name || ' ' || c.last_name AS customer_name,
    p.product_name,
    cat.category_name,
    oi.quantity,
    oi.price,
    oi.quantity * oi.price AS item_total,
    o.order_date
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
INNER JOIN categories cat ON p.category_id = cat.category_id
WHERE o.order_date >= '2024-03-01' AND o.order_date < '2024-04-01'
ORDER BY o.order_date, o.order_id, oi.order_item_id;

-- –ó–∞–¥–∞—á–∞ 4.4: –¢–æ–ø-–ø—Ä–æ–¥–∞–≤—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
    cat.category_name,
    p.product_name,
    SUM(oi.quantity) AS total_sold,
    SUM(oi.quantity * oi.price) AS total_revenue,
    COUNT(DISTINCT oi.order_id) AS orders_count,
    AVG(oi.price) AS avg_selling_price
FROM categories cat
INNER JOIN products p ON cat.category_id = p.category_id
INNER JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY cat.category_id, cat.category_name, p.product_id, p.product_name
HAVING SUM(oi.quantity) >= 10  -- –ú–∏–Ω–∏–º—É–º 10 –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü
ORDER BY cat.category_name, total_revenue DESC;
```

#### 3Ô∏è‚É£ LEFT JOIN ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ó–∞–¥–∞—á–∞ 4.5: –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤ (–≤–∫–ª—é—á–∞—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –∑–∞–∫–∞–∑—ã–≤–∞–ª)
SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.city,
    c.gender,
    c.registration_date,
    COUNT(o.order_id) AS orders_count,
    COALESCE(SUM(o.total_amount), 0) AS total_spent,
    COALESCE(AVG(o.total_amount), 0) AS avg_order_value,
    COALESCE(MAX(o.order_date), '–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤') AS last_order_date,
    julianday('now') - julianday(c.registration_date) AS days_registered,
    
    -- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
    CASE 
        WHEN COUNT(o.order_id) = 0 THEN '–ù–µ –ø–æ–∫—É–ø–∞–ª'
        WHEN COUNT(o.order_id) = 1 THEN '–†–∞–∑–æ–≤—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å'
        WHEN COUNT(o.order_id) <= 3 THEN '–†–µ–¥–∫–∏–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å'
        WHEN COUNT(o.order_id) <= 10 THEN '–†–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å'
        ELSE 'VIP –∫–ª–∏–µ–Ω—Ç'
    END AS customer_type
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.city, c.gender, c.registration_date
ORDER BY total_spent DESC;

-- –ó–∞–¥–∞—á–∞ 4.6: –¢–æ–≤–∞—Ä—ã –∏ –∏—Ö –ø—Ä–æ–¥–∞–∂–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ)
SELECT 
    cat.category_name,
    p.product_id,
    p.product_name,
    p.price AS catalog_price,
    p.stock_quantity,
    COUNT(oi.order_item_id) AS times_ordered,
    COALESCE(SUM(oi.quantity), 0) AS total_sold,
    COALESCE(SUM(oi.quantity * oi.price), 0) AS total_revenue,
    COALESCE(AVG(oi.price), p.price) AS avg_selling_price,
    p.stock_quantity - COALESCE(SUM(oi.quantity), 0) AS remaining_stock,
    
    -- –°—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞
    CASE 
        WHEN COUNT(oi.order_item_id) = 0 THEN '–ù–µ –ø—Ä–æ–¥–∞–≤–∞–ª—Å—è'
        WHEN COUNT(oi.order_item_id) <= 5 THEN '–ù–∏–∑–∫–∏–π —Å–ø—Ä–æ—Å'
        WHEN COUNT(oi.order_item_id) <= 20 THEN '–°—Ä–µ–¥–Ω–∏–π —Å–ø—Ä–æ—Å'
        ELSE '–í—ã—Å–æ–∫–∏–π —Å–ø—Ä–æ—Å'
    END AS demand_level
FROM categories cat
LEFT JOIN products p ON cat.category_id = p.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY cat.category_name, p.product_id, p.product_name, p.price, p.stock_quantity
ORDER BY cat.category_name, total_revenue DESC;
```

#### 4Ô∏è‚É£ –°–ª–æ–∂–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã

```sql
-- –ó–∞–¥–∞—á–∞ 4.7: –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
    c.city,
    c.gender,
    cat.category_name,
    COUNT(DISTINCT c.customer_id) AS customers_in_category,
    COUNT(DISTINCT o.order_id) AS orders_count,
    SUM(oi.quantity) AS items_purchased,
    SUM(oi.quantity * oi.price) AS category_revenue,
    AVG(oi.price) AS avg_item_price,
    AVG(o.total_amount) AS avg_order_value
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
INNER JOIN categories cat ON p.category_id = cat.category_id
WHERE c.city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫')
  AND o.order_date >= '2024-01-01'
GROUP BY c.city, c.gender, cat.category_id, cat.category_name
HAVING COUNT(DISTINCT o.order_id) >= 5  -- –ú–∏–Ω–∏–º—É–º 5 –∑–∞–∫–∞–∑–æ–≤
ORDER BY c.city, c.gender, category_revenue DESC;

-- –ó–∞–¥–∞—á–∞ 4.8: –ö—Ä–æ—Å—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫—É–ø–∞—é—Ç –≤–º–µ—Å—Ç–µ)
SELECT 
    cat1.category_name AS category_1,
    cat2.category_name AS category_2,
    COUNT(DISTINCT o.order_id) AS orders_with_both,
    COUNT(DISTINCT o.customer_id) AS customers_bought_both,
    AVG(o.total_amount) AS avg_order_value,
    SUM(oi1.quantity * oi1.price + oi2.quantity * oi2.price) AS combined_revenue
FROM orders o
INNER JOIN order_items oi1 ON o.order_id = oi1.order_id
INNER JOIN order_items oi2 ON o.order_id = oi2.order_id AND oi1.order_item_id != oi2.order_item_id
INNER JOIN products p1 ON oi1.product_id = p1.product_id
INNER JOIN products p2 ON oi2.product_id = p2.product_id
INNER JOIN categories cat1 ON p1.category_id = cat1.category_id
INNER JOIN categories cat2 ON p2.category_id = cat2.category_id
WHERE cat1.category_id < cat2.category_id  -- –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä
  AND o.order_date >= '2024-01-01'
GROUP BY cat1.category_id, cat1.category_name, cat2.category_id, cat2.category_name
HAVING COUNT(DISTINCT o.order_id) >= 10
ORDER BY orders_with_both DESC;
```

#### 5Ô∏è‚É£ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –±–∏–∑–Ω–µ—Å-–∑–∞–ø—Ä–æ—Å—ã

```sql
-- –ó–∞–¥–∞—á–∞ 4.9: –û—Ç—á–µ—Ç –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
SELECT 
    c.customer_id,
    c.first_name || ' ' || c.last_name AS customer_name,
    c.city,
    c.email,
    c.registration_date,
    COUNT(DISTINCT o.order_id) AS total_orders,
    COUNT(DISTINCT DATE(o.order_date)) AS active_days,
    SUM(o.total_amount) AS lifetime_value,
    AVG(o.total_amount) AS avg_order_value,
    MIN(o.order_date) AS first_order,
    MAX(o.order_date) AS last_order,
    julianday(MAX(o.order_date)) - julianday(MIN(o.order_date)) AS customer_lifespan_days,
    julianday('now') - julianday(MAX(o.order_date)) AS days_since_last_order,
    
    -- –ú–µ—Ç—Ä–∏–∫–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
    COUNT(DISTINCT strftime('%Y-%m', o.order_date)) AS active_months,
    ROUND(COUNT(DISTINCT o.order_id) * 1.0 / COUNT(DISTINCT strftime('%Y-%m', o.order_date)), 2) AS orders_per_month,
    
    -- –û—Ü–µ–Ω–∫–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
    CASE 
        WHEN COUNT(DISTINCT o.order_id) >= 10 AND julianday('now') - julianday(MAX(o.order_date)) <= 30 
            AND SUM(o.total_amount) >= 100000
        THEN '–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π'
        WHEN COUNT(DISTINCT o.order_id) >= 5 AND julianday('now') - julianday(MAX(o.order_date)) <= 90 
            AND SUM(o.total_amount) >= 50000
        THEN '–ó–æ–ª–æ—Ç–æ–π'
        WHEN COUNT(DISTINCT o.order_id) >= 3 AND julianday('now') - julianday(MAX(o.order_date)) <= 180
        THEN '–°–µ—Ä–µ–±—Ä—è–Ω—ã–π'
        WHEN julianday('now') - julianday(MAX(o.order_date)) > 365
        THEN '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'
        ELSE '–ë—Ä–æ–Ω–∑–æ–≤—ã–π'
    END AS loyalty_tier
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.city, c.email, c.registration_date
ORDER BY lifetime_value DESC;

-- –ó–∞–¥–∞—á–∞ 4.10: –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤
SELECT 
    cat.category_name,
    COUNT(DISTINCT p.product_id) AS products_in_category,
    COUNT(DISTINCT oi.order_id) AS orders_with_category,
    COUNT(DISTINCT o.customer_id) AS customers_bought_category,
    SUM(oi.quantity) AS total_items_sold,
    SUM(oi.quantity * oi.price) AS total_revenue,
    AVG(oi.price) AS avg_selling_price,
    AVG(p.price) AS avg_catalog_price,
    ROUND(AVG(oi.price) / AVG(p.price) * 100, 2) AS avg_discount_percent,
    
    -- –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    ROUND(SUM(oi.quantity * oi.price) / COUNT(DISTINCT p.product_id), 2) AS revenue_per_product,
    ROUND(SUM(oi.quantity) / COUNT(DISTINCT p.product_id), 2) AS items_sold_per_product,
    ROUND(COUNT(DISTINCT o.customer_id) * 100.0 / (SELECT COUNT(*) FROM customers), 2) AS customer_penetration_percent,
    
    -- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    CASE 
        WHEN SUM(oi.quantity * oi.price) / COUNT(DISTINCT p.product_id) > 100000 THEN '–í—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω–∞—è'
        WHEN SUM(oi.quantity * oi.price) / COUNT(DISTINCT p.product_id) > 50000 THEN '–°—Ä–µ–¥–Ω–µ–¥–æ—Ö–æ–¥–Ω–∞—è'
        ELSE '–ù–∏–∑–∫–æ–¥–æ—Ö–æ–¥–Ω–∞—è'
    END AS revenue_category,
    
    CASE 
        WHEN COUNT(DISTINCT o.customer_id) * 100.0 / (SELECT COUNT(*) FROM customers) > 50 THEN '–ü–æ–ø—É–ª—è—Ä–Ω–∞—è'
        WHEN COUNT(DISTINCT o.customer_id) * 100.0 / (SELECT COUNT(*) FROM customers) > 25 THEN '–°—Ä–µ–¥–Ω—è—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å'
        ELSE '–ù–∏—à–µ–≤–∞—è'
    END AS popularity_category
FROM categories cat
LEFT JOIN products p ON cat.category_id = p.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
LEFT JOIN orders o ON oi.order_id = o.order_id
WHERE o.order_date >= '2024-01-01' OR o.order_date IS NULL
GROUP BY cat.category_id, cat.category_name
ORDER BY total_revenue DESC;
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ JOIN –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ù–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–≥–æ—Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –û–ø—ã—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á–µ—Ç–æ–≤
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ JOIN –∑–∞–ø—Ä–æ—Å—ã

---

## üìã –ó–∞–¥–∞–Ω–∏–µ 5: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑ (Capstone Project)

**üéØ –¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Power Query

**üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** SQLite DB Browser, Power BI/Excel —Å Power Query

**‚è±Ô∏è –í—Ä–µ–º—è:** 150 –º–∏–Ω—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

```sql
-- –ó–∞–¥–∞—á–∞ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö
CREATE VIEW v_order_details AS
SELECT 
    o.order_id,
    o.customer_id,
    c.first_name || ' ' || c.last_name AS customer_name,
    c.city,
    c.gender,
    o.order_date,
    strftime('%Y', o.order_date) AS order_year,
    strftime('%m', o.order_date) AS order_month,
    strftime('%Y-%m', o.order_date) AS order_year_month,
    CASE strftime('%w', o.order_date)
        WHEN '0' THEN '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'
        WHEN '1' THEN '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'
        WHEN '2' THEN '–í—Ç–æ—Ä–Ω–∏–∫'
        WHEN '3' THEN '–°—Ä–µ–¥–∞'
        WHEN '4' THEN '–ß–µ—Ç–≤–µ—Ä–≥'
        WHEN '5' THEN '–ü—è—Ç–Ω–∏—Ü–∞'
        WHEN '6' THEN '–°—É–±–±–æ—Ç–∞'
    END AS order_day_of_week,
    o.total_amount,
    CASE 
        WHEN o.total_amount >= 100000 THEN '–ü—Ä–µ–º–∏—É–º'
        WHEN o.total_amount >= 50000 THEN '–í—ã—Å–æ–∫–∏–π'
        WHEN o.total_amount >= 20000 THEN '–°—Ä–µ–¥–Ω–∏–π'
        ELSE '–ë–∞–∑–æ–≤—ã–π'
    END AS order_tier
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏
CREATE VIEW v_product_performance AS
SELECT 
    p.product_id,
    p.product_name,
    cat.category_name,
    p.price AS catalog_price,
    p.stock_quantity,
    COUNT(oi.order_item_id) AS times_ordered,
    COALESCE(SUM(oi.quantity), 0) AS total_sold,
    COALESCE(SUM(oi.quantity * oi.price), 0) AS total_revenue,
    COALESCE(AVG(oi.price), p.price) AS avg_selling_price,
    COALESCE(MAX(DATE(o.order_date)), '–ù–∏–∫–æ–≥–¥–∞') AS last_sale_date
FROM products p
JOIN categories cat ON p.category_id = cat.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
LEFT JOIN orders o ON oi.order_id = o.order_id
GROUP BY p.product_id, p.product_name, cat.category_name, p.price, p.stock_quantity;

-- –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
SELECT * FROM v_order_details WHERE order_year_month = '2024-03' LIMIT 10;
SELECT * FROM v_product_performance ORDER BY total_revenue DESC LIMIT 10;
```

#### 2Ô∏è‚É£ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

```sql
-- –ó–∞–¥–∞—á–∞ 5.2: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏

-- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ–¥–∞–∂
SELECT 
    order_year_month,
    monthly_revenue,
    customers_count,
    orders_count,
    
    -- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –º–µ—Å—è—Ü–µ–º (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥–∑–∞–ø—Ä–æ—Å)
    (SELECT SUM(total_amount) 
     FROM v_order_details v2 
     WHERE v2.order_year_month = 
        (SELECT MAX(v3.order_year_month) 
         FROM v_order_details v3 
         WHERE v3.order_year_month < v1.order_year_month)) AS prev_month_revenue,
    
    -- –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–æ—Å—Ç–∞
    ROUND(
        (monthly_revenue - 
         (SELECT SUM(total_amount) 
          FROM v_order_details v2 
          WHERE v2.order_year_month = 
            (SELECT MAX(v3.order_year_month) 
             FROM v_order_details v3 
             WHERE v3.order_year_month < v1.order_year_month))
        ) * 100.0 / 
        NULLIF((SELECT SUM(total_amount) 
                FROM v_order_details v2 
                WHERE v2.order_year_month = 
                  (SELECT MAX(v3.order_year_month) 
                   FROM v_order_details v3 
                   WHERE v3.order_year_month < v1.order_year_month)), 0), 2
    ) AS growth_percent
FROM (
    SELECT 
        order_year_month,
        SUM(total_amount) AS monthly_revenue,
        COUNT(DISTINCT customer_id) AS customers_count,
        COUNT(*) AS orders_count
    FROM v_order_details
    WHERE order_year >= '2023'
    GROUP BY order_year_month
) v1
ORDER BY order_year_month;

-- –ó–∞–¥–∞—á–∞ 5.3: –ü–æ–∏—Å–∫ –≤—ã–±—Ä–æ—Å–æ–≤ –∏ –∞–Ω–æ–º–∞–ª–∏–π
-- –ö–ª–∏–µ–Ω—Ç—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏
SELECT 
    customer_id,
    customer_name,
    city,
    order_id,
    order_date,
    total_amount,
    
    -- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∫–ª–∏–µ–Ω—Ç–∞
    (SELECT AVG(total_amount) 
     FROM v_order_details v2 
     WHERE v2.customer_id = v1.customer_id) AS customer_avg_order,
    
    -- –û–±—â–∏–π —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
    (SELECT AVG(total_amount) FROM v_order_details) AS global_avg_order,
    
    -- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ª–∏—á–Ω–æ–π –Ω–æ—Ä–º—ã –∫–ª–∏–µ–Ω—Ç–∞
    ROUND(total_amount / 
          NULLIF((SELECT AVG(total_amount) 
                  FROM v_order_details v2 
                  WHERE v2.customer_id = v1.customer_id), 0), 2) AS personal_deviation,
    
    -- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –æ–±—â–µ–π –Ω–æ—Ä–º—ã
    ROUND(total_amount / 
          (SELECT AVG(total_amount) FROM v_order_details), 2) AS global_deviation
FROM v_order_details v1
WHERE total_amount > (
    SELECT AVG(total_amount) + 2 * 
    (SELECT 
        SQRT(AVG((total_amount - (SELECT AVG(total_amount) FROM v_order_details)) * 
                 (total_amount - (SELECT AVG(total_amount) FROM v_order_details))))
     FROM v_order_details)
    FROM v_order_details
)
ORDER BY total_amount DESC;
```

#### 3Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ KPI –¥–∞—à–±–æ—Ä–¥–∞

```sql
-- –ó–∞–¥–∞—á–∞ 5.4: –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞

-- –û—Å–Ω–æ–≤–Ω—ã–µ KPI –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30, 90 –∏ 365 –¥–Ω–µ–π
WITH kpi_periods AS (
    SELECT '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π' AS period, 30 AS days
    UNION ALL SELECT '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π', 90
    UNION ALL SELECT '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 365 –¥–Ω–µ–π', 365
),
kpi_calculations AS (
    SELECT 
        kp.period,
        COUNT(DISTINCT vod.order_id) AS orders_count,
        COUNT(DISTINCT vod.customer_id) AS unique_customers,
        SUM(vod.total_amount) AS total_revenue,
        AVG(vod.total_amount) AS avg_order_value,
        SUM(vod.total_amount) / COUNT(DISTINCT vod.customer_id) AS revenue_per_customer,
        COUNT(DISTINCT vod.order_id) / COUNT(DISTINCT vod.customer_id) AS orders_per_customer,
        COUNT(DISTINCT DATE(vod.order_date)) AS active_days,
        SUM(vod.total_amount) / COUNT(DISTINCT DATE(vod.order_date)) AS avg_daily_revenue
    FROM kpi_periods kp
    LEFT JOIN v_order_details vod ON 
        julianday('now') - julianday(vod.order_date) <= kp.days
    GROUP BY kp.period, kp.days
)
SELECT 
    period,
    orders_count,
    unique_customers,
    ROUND(total_revenue, 2) AS total_revenue,
    ROUND(avg_order_value, 2) AS avg_order_value,
    ROUND(revenue_per_customer, 2) AS revenue_per_customer,
    ROUND(orders_per_customer, 2) AS orders_per_customer,
    active_days,
    ROUND(avg_daily_revenue, 2) AS avg_daily_revenue
FROM kpi_calculations
ORDER BY 
    CASE 
        WHEN period = '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π' THEN 1
        WHEN period = '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π' THEN 2
        WHEN period = '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 365 –¥–Ω–µ–π' THEN 3
    END;

-- –ó–∞–¥–∞—á–∞ 5.5: –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –≥–æ—Ä–æ–¥–∞–º
SELECT 
    city,
    total_customers,
    customers_with_orders,
    ROUND(customers_with_orders * 100.0 / total_customers, 2) AS conversion_rate,
    total_orders,
    ROUND(total_orders * 1.0 / customers_with_orders, 2) AS orders_per_active_customer,
    total_revenue,
    ROUND(total_revenue / customers_with_orders, 2) AS revenue_per_active_customer,
    ROUND(total_revenue / total_orders, 2) AS avg_order_value
FROM (
    SELECT 
        c.city,
        COUNT(c.customer_id) AS total_customers,
        COUNT(DISTINCT o.customer_id) AS customers_with_orders,
        COUNT(o.order_id) AS total_orders,
        COALESCE(SUM(o.total_amount), 0) AS total_revenue
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    WHERE c.city IN ('–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å')
    GROUP BY c.city
) city_stats
ORDER BY conversion_rate DESC;
```

#### 4Ô∏è‚É£ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Power Query

```sql
-- –ó–∞–¥–∞—á–∞ 5.6: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è Power Query/Power BI

-- –ó–∞–ø—Ä–æ—Å 1: –ú–µ—Å—è—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
-- –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ Power BI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
SELECT 
    strftime('%Y-%m', order_date) AS YearMonth,
    strftime('%Y', order_date) AS Year,
    strftime('%m', order_date) AS Month,
    CASE strftime('%m', order_date)
        WHEN '01' THEN '–Ø–Ω–≤–∞—Ä—å'
        WHEN '02' THEN '–§–µ–≤—Ä–∞–ª—å'
        WHEN '03' THEN '–ú–∞—Ä—Ç'
        WHEN '04' THEN '–ê–ø—Ä–µ–ª—å'
        WHEN '05' THEN '–ú–∞–π'
        WHEN '06' THEN '–ò—é–Ω—å'
        WHEN '07' THEN '–ò—é–ª—å'
        WHEN '08' THEN '–ê–≤–≥—É—Å—Ç'
        WHEN '09' THEN '–°–µ–Ω—Ç—è–±—Ä—å'
        WHEN '10' THEN '–û–∫—Ç—è–±—Ä—å'
        WHEN '11' THEN '–ù–æ—è–±—Ä—å'
        WHEN '12' THEN '–î–µ–∫–∞–±—Ä—å'
    END AS MonthName,
    COUNT(*) AS OrdersCount,
    COUNT(DISTINCT customer_id) AS UniqueCustomers,
    SUM(total_amount) AS TotalRevenue,
    AVG(total_amount) AS AvgOrderValue,
    MIN(total_amount) AS MinOrderValue,
    MAX(total_amount) AS MaxOrderValue
FROM orders
WHERE order_date >= '2023-01-01'
GROUP BY strftime('%Y-%m', order_date)
ORDER BY YearMonth;

-- –ó–∞–ø—Ä–æ—Å 2: –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–æ–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ø–æ –≥–æ—Ä–æ–¥–∞–º)
SELECT 
    c.city AS City,
    COUNT(DISTINCT c.customer_id) AS TotalCustomers,
    COUNT(o.order_id) AS TotalOrders,
    COUNT(DISTINCT o.customer_id) AS ActiveCustomers,
    SUM(o.total_amount) AS TotalRevenue,
    AVG(o.total_amount) AS AvgOrderValue,
    ROUND(COUNT(o.order_id) * 1.0 / COUNT(DISTINCT c.customer_id), 2) AS OrdersPerCustomer,
    ROUND(SUM(o.total_amount) / COUNT(DISTINCT c.customer_id), 2) AS RevenuePerCustomer,
    ROUND(COUNT(DISTINCT o.customer_id) * 100.0 / COUNT(DISTINCT c.customer_id), 2) AS ConversionRate,
    
    -- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–µ (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ)
    CASE c.city
        WHEN '–ú–æ—Å–∫–≤–∞' THEN 55.7558
        WHEN '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥' THEN 59.9311
        WHEN '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫' THEN 55.0084
        WHEN '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥' THEN 56.8431
        WHEN '–ö–∞–∑–∞–Ω—å' THEN 55.8304
        WHEN '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥' THEN 56.2965
        ELSE 55.0000
    END AS Latitude,
    
    CASE c.city
        WHEN '–ú–æ—Å–∫–≤–∞' THEN 37.6176
        WHEN '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥' THEN 30.3609
        WHEN '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫' THEN 82.9357
        WHEN '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥' THEN 60.6454
        WHEN '–ö–∞–∑–∞–Ω—å' THEN 49.0661
        WHEN '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥' THEN 44.0845
        ELSE 37.0000
    END AS Longitude
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.city
HAVING COUNT(DISTINCT c.customer_id) >= 10  -- –¢–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–∞ —Å –º–∏–Ω–∏–º—É–º 10 –∫–ª–∏–µ–Ω—Ç–∞–º–∏
ORDER BY TotalRevenue DESC;

-- –ó–∞–ø—Ä–æ—Å 3: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π –ª–∏–Ω–µ–π–∫–∏
SELECT 
    cat.category_name AS CategoryName,
    p.product_name AS ProductName,
    p.price AS CatalogPrice,
    COUNT(oi.order_item_id) AS TimesOrdered,
    SUM(oi.quantity) AS TotalQuantitySold,
    SUM(oi.quantity * oi.price) AS TotalRevenue,
    AVG(oi.price) AS AvgSellingPrice,
    p.stock_quantity AS CurrentStock,
    
    -- –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    ROUND(SUM(oi.quantity * oi.price) / NULLIF(COUNT(oi.order_item_id), 0), 2) AS RevenuePerOrder,
    ROUND(AVG(oi.price) / p.price * 100, 2) AS AvgDiscountPercent,
    
    -- –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–¥–∞–∂–∞
    MAX(o.order_date) AS LastSaleDate,
    julianday('now') - julianday(MAX(o.order_date)) AS DaysSinceLastSale
FROM categories cat
JOIN products p ON cat.category_id = p.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
LEFT JOIN orders o ON oi.order_id = o.order_id
GROUP BY cat.category_name, p.product_id, p.product_name, p.price, p.stock_quantity
ORDER BY cat.category_name, TotalRevenue DESC;
```

#### 5Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ Power Query –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Power BI –∫ SQLite:**

```
1. –û—Ç–∫—Ä–æ–π—Ç–µ Power BI Desktop
2. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ ‚Üí –ë–æ–ª—å—à–µ ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí SQLite
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª ecommerce_database.db
4. –í –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–µ –≤—ã–±–µ—Ä–∏—Ç–µ "–ó–∞–ø—Ä–æ—Å SQL" 
5. –í—Å—Ç–∞–≤—å—Ç–µ –æ–¥–∏–Ω –∏–∑ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã—à–µ
6. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" –∏–ª–∏ "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"
```

**Power Query M –∫–æ–¥ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:**

```m
// –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
let
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏)
    StartDate = #date(2024, 1, 1),
    EndDate = Date.From(DateTime.LocalNow()),
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –≤ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è SQL
    StartDateText = Date.ToText(StartDate, "yyyy-MM-dd"),
    EndDateText = Date.ToText(EndDate, "yyyy-MM-dd"),
    
    // SQL –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    SqlQuery = "
    SELECT 
        strftime('%Y-%m', order_date) AS YearMonth,
        COUNT(*) AS OrdersCount,
        COUNT(DISTINCT customer_id) AS UniqueCustomers,
        SUM(total_amount) AS TotalRevenue,
        AVG(total_amount) AS AvgOrderValue
    FROM orders
    WHERE order_date >= '" & StartDateText & "' 
      AND order_date <= '" & EndDateText & "'
    GROUP BY strftime('%Y-%m', order_date)
    ORDER BY YearMonth
    ",
    
    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    Source = Sqlite.Database(File.Contents("C:\path\to\ecommerce_database.db"), [Query=SqlQuery]),
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    ChangedTypes = Table.TransformColumnTypes(Source, {
        {"YearMonth", type text},
        {"OrdersCount", Int64.Type},
        {"UniqueCustomers", Int64.Type},
        {"TotalRevenue", type number},
        {"AvgOrderValue", type number}
    })
in
    ChangedTypes
```

#### 6Ô∏è‚É£ –§–∏–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç

```sql
-- –ó–∞–¥–∞—á–∞ 5.7: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ (Executive Summary)
-- –°–æ–∑–¥–∞–π—Ç–µ –æ–¥–∏–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É –±–∏–∑–Ω–µ—Å–∞

WITH business_summary AS (
    -- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    SELECT 
        COUNT(DISTINCT c.customer_id) AS total_customers,
        COUNT(DISTINCT o.order_id) AS total_orders,
        COUNT(DISTINCT p.product_id) AS total_products,
        COUNT(DISTINCT cat.category_id) AS total_categories,
        SUM(o.total_amount) AS total_revenue,
        AVG(o.total_amount) AS avg_order_value,
        MIN(o.order_date) AS first_order_date,
        MAX(o.order_date) AS last_order_date
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    LEFT JOIN order_items oi ON o.order_id = oi.order_id
    LEFT JOIN products p ON oi.product_id = p.product_id
    LEFT JOIN categories cat ON p.category_id = cat.category_id
),
customer_segments AS (
    -- –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
    SELECT 
        customer_segment,
        COUNT(*) AS customers_count,
        AVG(total_spent) AS avg_customer_value,
        SUM(total_spent) AS segment_revenue
    FROM (
        SELECT 
            c.customer_id,
            CASE 
                WHEN COUNT(o.order_id) >= 10 AND SUM(o.total_amount) >= 200000 THEN 'VIP'
                WHEN COUNT(o.order_id) >= 5 AND SUM(o.total_amount) >= 100000 THEN '–ü—Ä–µ–º–∏—É–º'
                WHEN COUNT(o.order_id) >= 3 AND SUM(o.total_amount) >= 50000 THEN '–°—Ç–∞–Ω–¥–∞—Ä—Ç'
                WHEN COUNT(o.order_id) >= 1 THEN '–ë–∞–∑–æ–≤—ã–π'
                ELSE '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'
            END AS customer_segment,
            COALESCE(SUM(o.total_amount), 0) AS total_spent
        FROM customers c
        LEFT JOIN orders o ON c.customer_id = o.customer_id
        GROUP BY c.customer_id
    )
    GROUP BY customer_segment
),
top_categories AS (
    -- –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    SELECT 
        cat.category_name,
        SUM(oi.quantity * oi.price) AS category_revenue,
        COUNT(DISTINCT o.customer_id) AS customers_count
    FROM categories cat
    JOIN products p ON cat.category_id = p.category_id
    JOIN order_items oi ON p.product_id = oi.product_id
    JOIN orders o ON oi.order_id = o.order_id
    GROUP BY cat.category_id, cat.category_name
    ORDER BY category_revenue DESC
    LIMIT 5
)
-- –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
SELECT 
    '–û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏' AS section,
    '–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ' || bs.total_customers || 
    ', –ó–∞–∫–∞–∑–æ–≤: ' || bs.total_orders ||
    ', –í—ã—Ä—É—á–∫–∞: ' || ROUND(bs.total_revenue, 0) || ' —Ä—É–±.' ||
    ', –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ' || ROUND(bs.avg_order_value, 0) || ' —Ä—É–±.' AS metrics
FROM business_summary bs

UNION ALL

SELECT 
    '–°–µ–≥–º–µ–Ω—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤' AS section,
    customer_segment || ': ' || customers_count || ' –∫–ª–∏–µ–Ω—Ç–æ–≤ (' ||
    ROUND(segment_revenue, 0) || ' —Ä—É–±., —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–Ω–æ—Å—Ç—å: ' ||
    ROUND(avg_customer_value, 0) || ' —Ä—É–±.)' AS metrics
FROM customer_segments
ORDER BY 
    CASE 
        WHEN section = '–û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏' THEN 1
        ELSE 2
    END,
    metrics DESC;
```

### ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views)** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã** —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏  
- **KPI –¥–∞—à–±–æ—Ä–¥** —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –±–∏–∑–Ω–µ—Å–∞
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Power Query** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑** —Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ–∑—é–º–µ
- **–§–∞–π–ª—ã:** SQL —Å–∫—Ä–∏–ø—Ç—ã, Power Query M –∫–æ–¥, –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

### üìã –û–±—â–∏–µ —Å–æ–≤–µ—Ç—ã:

1. **üîÑ –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É—Å–ª–æ–∂–Ω—è—è
2. **üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ .sql —Ñ–∞–π–ª—ã
3. **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è–º
4. **üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:** –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Ç–µ, –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û:**
- DB Browser for SQLite (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- Power BI Desktop –∏–ª–∏ Excel —Å Power Query
- –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è SQL —Å–∫—Ä–∏–ø—Ç–æ–≤

**–§–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã:**
- `ecommerce_database.db` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `sample_queries.sql` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
- `powerquery_examples.txt` ‚Äî M –∫–æ–¥ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```
chapter-19-results/
‚îú‚îÄ‚îÄ task-1-basic-select.sql
‚îú‚îÄ‚îÄ task-2-filtering-sorting.sql  
‚îú‚îÄ‚îÄ task-3-aggregates-groupby.sql
‚îú‚îÄ‚îÄ task-4-joins.sql
‚îú‚îÄ‚îÄ task-5-complex-analysis.sql
‚îú‚îÄ‚îÄ power-query-integration.m
‚îî‚îÄ‚îÄ executive-summary.txt
```

### ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

**Q: –ö–∞–∫—É—é –°–£–ë–î –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
A: SQLite –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (–ø—Ä–æ—Å—Ç–æ—Ç–∞), PostgreSQL/MySQL –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**Q: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç GROUP BY?**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –≤ SELECT –ª–∏–±–æ –≤ GROUP BY, –ª–∏–±–æ –≤ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

**Q: –ú–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã?**
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LIMIT –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ WHERE —É—Å–ª–æ–≤–∏—è

**Q: –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Power Query –∫ SQLite?**
A: –ß–µ—Ä–µ–∑ "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" ‚Üí "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" ‚Üí "SQLite" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ .db —Ñ–∞–π–ª

---

- üîô [–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 18 - –†–∞–±–æ—Ç–∞ —Å API: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](../chapter-18/README.md)
- üîú [–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞: –ì–ª–∞–≤–∞ 20 - SQL: JOIN, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, CTE](../chapter-20/README.md)

---

- üì¢ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —á–∞—Ç—É –∫—É—Ä—Å–∞: https://t.me/analytics_course_chat
- üì¢ –ö–∞–Ω–∞–ª –∫—É—Ä—Å–∞: https://t.me/analytics_course_channel